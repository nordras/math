{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/projetos/math/lib/generators/mathGenerator.js"],"sourcesContent":["/**\r\n * Gerador Matem√°tico Puro\r\n * Gera problemas de adi√ß√£o e subtra√ß√£o sem envolvimento de IA\r\n * Toda a l√≥gica matem√°tica √© controlada e validada\r\n */\r\n\r\nclass MathGenerator {\r\n  constructor(options = {}) {\r\n    this.options = {\r\n      totalProblems: options.totalProblems || 50,\r\n      additionRatio: options.additionRatio || 0.5,\r\n      difficulty: options.difficulty || 'medium',\r\n      avoidSequenceLength: options.avoidSequenceLength || 4,\r\n      threeDigitRatio: options.threeDigitRatio || 0.25, // 25% com 3 algarismos\r\n      ...options\r\n    };\r\n\r\n    this.difficultyLevels = {\r\n      easy: { min: 1, max: 10, allowNegative: false },\r\n      medium: { min: 1, max: 20, allowNegative: false },\r\n      hard: { min: 1, max: 50, allowNegative: false }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Gera um n√∫mero aleat√≥rio entre min e max (inclusivo)\r\n   */\r\n  randomInt(min, max) {\r\n    return Math.floor(Math.random() * (max - min + 1)) + min;\r\n  }\r\n\r\n  /**\r\n   * Embaralha um array usando Fisher-Yates \r\n   * https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle\r\n   * https://youtu.be/4zx5bM2OcvA\r\n   */\r\n  shuffle(array) {\r\n    const shuffled = [...array];\r\n    for (let i = shuffled.length - 1; i > 0; i--) {\r\n      const j = Math.floor(Math.random() * (i + 1));\r\n      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];\r\n    }\r\n    return shuffled;\r\n  }\r\n\r\n  /**\r\n   * Gera um problema de adi√ß√£o\r\n   */\r\n  generateAddition(difficulty = 'medium', useThreeDigits = false) {\r\n    const range = this.difficultyLevels[difficulty];\r\n    let num1, num2;\r\n    \r\n    if (useThreeDigits) {\r\n      // N√∫meros de 3 algarismos (100-999)\r\n      num1 = this.randomInt(100, 999);\r\n      num2 = this.randomInt(100, 999);\r\n    } else {\r\n      num1 = this.randomInt(range.min, range.max);\r\n      num2 = this.randomInt(range.min, range.max);\r\n    }\r\n\r\n    return {\r\n      type: 'addition',\r\n      operation: '+',\r\n      num1,\r\n      num2,\r\n      answer: num1 + num2,\r\n      difficulty,\r\n      threeDigits: useThreeDigits,\r\n      display: `${num1} + ${num2}`\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Gera um problema de subtra√ß√£o\r\n   * Garante que o resultado seja sempre positivo (ou zero)\r\n   */\r\n  generateSubtraction(difficulty = 'medium', useThreeDigits = false) {\r\n    const range = this.difficultyLevels[difficulty];\r\n    let num1, num2;\r\n    \r\n    if (useThreeDigits) {\r\n      // N√∫meros de 3 algarismos (100-999)\r\n      num1 = this.randomInt(100, 999);\r\n      const maxNum2 = num1; // Garantir resultado positivo\r\n      num2 = this.randomInt(100, maxNum2);\r\n    } else {\r\n      num1 = this.randomInt(range.min, range.max);\r\n      const maxNum2 = range.allowNegative ? range.max : num1;\r\n      num2 = this.randomInt(range.min, maxNum2);\r\n    }\r\n\r\n    return {\r\n      type: 'subtraction',\r\n      operation: '‚àí',\r\n      num1,\r\n      num2,\r\n      answer: num1 - num2,\r\n      difficulty,\r\n      threeDigits: useThreeDigits,\r\n      display: `${num1} ‚àí ${num2}`\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Gera um conjunto de problemas mistos\r\n   */\r\n  generateMixedProblems() {\r\n    const { totalProblems, additionRatio, difficulty, threeDigitRatio } = this.options;\r\n    const problems = [];\r\n\r\n    // Calcular quantos problemas de cada tipo\r\n    const additionCount = Math.floor(totalProblems * additionRatio);\r\n    const subtractionCount = totalProblems - additionCount;\r\n    \r\n    // Calcular quantos problemas ter√£o 3 algarismos\r\n    const threeDigitTotal = Math.floor(totalProblems * threeDigitRatio);\r\n    const threeDigitAddition = Math.floor(threeDigitTotal * additionRatio);\r\n    const threeDigitSubtraction = threeDigitTotal - threeDigitAddition;\r\n\r\n    // Gerar problemas de adi√ß√£o\r\n    for (let i = 0; i < additionCount; i++) {\r\n      const useThreeDigits = i < threeDigitAddition;\r\n      problems.push(this.generateAddition(difficulty, useThreeDigits));\r\n    }\r\n\r\n    // Gerar problemas de subtra√ß√£o\r\n    for (let i = 0; i < subtractionCount; i++) {\r\n      const useThreeDigits = i < threeDigitSubtraction;\r\n      problems.push(this.generateSubtraction(difficulty, useThreeDigits));\r\n    }\r\n\r\n    // Embaralhar\r\n    let shuffled = this.shuffle(problems);\r\n\r\n    // Evitar sequ√™ncias longas da mesma opera√ß√£o\r\n    shuffled = this.avoidLongSequences(shuffled);\r\n\r\n    // Adicionar n√∫mero de ordem\r\n    shuffled.forEach((problem, index) => {\r\n      problem.number = index + 1;\r\n    });\r\n\r\n    return shuffled;\r\n  }\r\n\r\n  /**\r\n   * Evita sequ√™ncias longas da mesma opera√ß√£o\r\n   * Por exemplo, evita mais de 3 adi√ß√µes seguidas\r\n   */\r\n  avoidLongSequences(problems) {\r\n    const maxSequence = this.options.avoidSequenceLength;\r\n    const result = [...problems];\r\n\r\n    for (let i = 0; i < result.length - maxSequence; i++) {\r\n      // Contar quantos do mesmo tipo em sequ√™ncia\r\n      let count = 1;\r\n      const currentType = result[i].type;\r\n\r\n      for (let j = i + 1; j < result.length && j < i + maxSequence; j++) {\r\n        if (result[j].type === currentType) {\r\n          count++;\r\n        } else {\r\n          break;\r\n        }\r\n      }\r\n\r\n      // Se encontrou uma sequ√™ncia muito longa, fazer swap\r\n      if (count >= maxSequence) {\r\n        // Procurar pr√≥ximo elemento de tipo diferente\r\n        for (let k = i + maxSequence; k < result.length; k++) {\r\n          if (result[k].type !== currentType) {\r\n            // Swap\r\n            const temp = result[i + maxSequence - 1];\r\n            result[i + maxSequence - 1] = result[k];\r\n            result[k] = temp;\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Valida se um problema est√° correto\r\n   */\r\n  validateProblem(problem) {\r\n    const { num1, num2, answer, type } = problem;\r\n\r\n    if (type === 'addition') {\r\n      return num1 + num2 === answer;\r\n    } else if (type === 'subtraction') {\r\n      return num1 - num2 === answer;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Gera estat√≠sticas sobre os problemas gerados\r\n   */\r\n  getStatistics(problems) {\r\n    const stats = {\r\n      total: problems.length,\r\n      addition: 0,\r\n      subtraction: 0,\r\n      threeDigits: 0,\r\n      difficulty: this.options.difficulty,\r\n      maxAnswer: 0,\r\n      minAnswer: Infinity,\r\n      avgAnswer: 0\r\n    };\r\n\r\n    let sumAnswers = 0;\r\n\r\n    problems.forEach(problem => {\r\n      if (problem.type === 'addition') stats.addition++;\r\n      if (problem.type === 'subtraction') stats.subtraction++;\r\n      if (problem.threeDigits) stats.threeDigits++;\r\n\r\n      stats.maxAnswer = Math.max(stats.maxAnswer, problem.answer);\r\n      stats.minAnswer = Math.min(stats.minAnswer, problem.answer);\r\n      sumAnswers += problem.answer;\r\n    });\r\n\r\n    stats.avgAnswer = Math.round(sumAnswers / problems.length);\r\n\r\n    return stats;\r\n  }\r\n}\r\n\r\nexport default MathGenerator;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 228, "column": 0}, "map": {"version":3,"sources":["file:///C:/projetos/math/lib/services/MathGeneratorService.ts"],"sourcesContent":["/**\r\n * Service for generating math problems\r\n * Encapsulates MathGenerator business logic\r\n */\r\n\r\nimport type { DigitConfig, MathProblem, MathStats } from '../types/math';\r\nimport MathGenerator from '../generators/mathGenerator.js';\r\n\r\ntype Operation = 'addition' | 'subtraction' | 'multiplication' | 'division' | 'mixed';\r\n\r\ninterface GenerateProblemsOptions {\r\n  totalProblems?: number;\r\n  difficulty?: 'easy' | 'medium' | 'hard';\r\n  additionRatio?: number;\r\n  digitConfigs?: DigitConfig[];\r\n}\r\n\r\ninterface GenerateProblemsResult {\r\n  problems: MathProblem[];\r\n  stats: MathStats;\r\n}\r\n\r\nexport class MathGeneratorService {\r\n  static generateProblems(options: GenerateProblemsOptions): GenerateProblemsResult {\r\n    const {\r\n      totalProblems = 50,\r\n      difficulty = 'medium',\r\n      additionRatio = 0.5,\r\n      digitConfigs = null,\r\n    } = options;\r\n\r\n    // If digitConfigs was provided, generate problems based on it\r\n    if (digitConfigs && Array.isArray(digitConfigs) && digitConfigs.length > 0) {\r\n      return this.generateFromDigitConfigs(digitConfigs);\r\n    }\r\n\r\n    // Fallback to old mode\r\n    const generator = new MathGenerator({\r\n      totalProblems,\r\n      difficulty,\r\n      additionRatio,\r\n    });\r\n\r\n    const problems = generator.generateMixedProblems();\r\n    const stats = generator.getStatistics(problems);\r\n\r\n    return {\r\n      problems,\r\n      stats,\r\n    };\r\n  }\r\n\r\n  static generateFromDigitConfigs(digitConfigs: DigitConfig[]): GenerateProblemsResult {\r\n    const allProblems: MathProblem[] = [];\r\n    \r\n    for (const config of digitConfigs) {\r\n      const { digits, questions, operation } = config;\r\n      \r\n      if (questions <= 0) continue;\r\n      \r\n      // Determine range based on digits\r\n      const min = Math.pow(10, digits - 1);\r\n      const max = Math.pow(10, digits) - 1;\r\n      \r\n      for (let i = 0; i < questions; i++) {\r\n        const num1 = Math.floor(Math.random() * (max - min + 1)) + min;\r\n        const num2 = Math.floor(Math.random() * (max - min + 1)) + min;\r\n        \r\n        let problemType: Operation;\r\n        if (operation === 'mixed') {\r\n          const operations: Operation[] = ['addition', 'subtraction', 'multiplication', 'division'];\r\n          problemType = operations[Math.floor(Math.random() * operations.length)];\r\n        } else {\r\n          problemType = operation;\r\n        }\r\n        \r\n        let problem: MathProblem;\r\n        switch (problemType) {\r\n          case 'addition':\r\n            problem = {\r\n              num1,\r\n              num2,\r\n              type: 'addition' as const,\r\n              operation: `${num1} + ${num2}`,\r\n              answer: num1 + num2,\r\n            };\r\n            break;\r\n          case 'subtraction':\r\n            const [larger, smaller] = num1 >= num2 ? [num1, num2] : [num2, num1];\r\n            problem = {\r\n              num1: larger,\r\n              num2: smaller,\r\n              type: 'subtraction' as const,\r\n              operation: `${larger} - ${smaller}`,\r\n              answer: larger - smaller,\r\n            };\r\n            break;\r\n          case 'multiplication':\r\n            problem = {\r\n              num1,\r\n              num2,\r\n              type: 'multiplication' as any,\r\n              operation: `${num1} √ó ${num2}`,\r\n              answer: num1 * num2,\r\n            };\r\n            break;\r\n          case 'division':\r\n            const divisorMin = config.divisorMin || 1;\r\n            const divisorMax = config.divisorMax || 10;\r\n            const divisor = Math.floor(Math.random() * (divisorMax - divisorMin + 1)) + divisorMin;\r\n            const quotient = Math.floor(Math.random() * (max - min + 1)) + min;\r\n            const dividend = divisor * quotient;\r\n            problem = {\r\n              num1: dividend,\r\n              num2: divisor,\r\n              type: 'division' as any,\r\n              operation: `${dividend} √∑ ${divisor}`,\r\n              answer: quotient,\r\n            };\r\n            break;\r\n          default:\r\n            problem = {\r\n              num1,\r\n              num2,\r\n              type: 'addition' as const,\r\n              operation: `${num1} + ${num2}`,\r\n              answer: num1 + num2,\r\n            };\r\n        }\r\n        \r\n        allProblems.push(problem);\r\n      }\r\n    }\r\n    \r\n    // Calculate statistics\r\n    const stats = {\r\n      totalProblems: allProblems.length,\r\n      additions: allProblems.filter(p => p.type === 'addition').length,\r\n      subtractions: allProblems.filter(p => p.type === 'subtraction').length,\r\n      multiplications: allProblems.filter(p => p.type === 'multiplication').length,\r\n      divisions: allProblems.filter(p => p.type === 'division').length,\r\n      difficulty: 'custom',\r\n      digitConfigs: digitConfigs,\r\n    };\r\n    \r\n    return {\r\n      problems: allProblems,\r\n      stats,\r\n    };\r\n  }\r\n\r\n  static validateOptions(options: GenerateProblemsOptions): GenerateProblemsOptions {\r\n    const validDifficulties: Array<'easy' | 'medium' | 'hard'> = ['easy', 'medium', 'hard'];\r\n    const { totalProblems, difficulty, additionRatio, digitConfigs } = options;\r\n\r\n    const validated: GenerateProblemsOptions = {\r\n      totalProblems: Math.max(1, Math.min(200, totalProblems || 50)),\r\n      difficulty: (validDifficulties.includes(difficulty as any) ? difficulty : 'medium') as 'easy' | 'medium' | 'hard',\r\n      additionRatio: Math.max(0, Math.min(1, additionRatio || 0.5)),\r\n    };\r\n\r\n    if (digitConfigs && Array.isArray(digitConfigs)) {\r\n      validated.digitConfigs = digitConfigs.map(config => ({\r\n        digits: Math.max(1, Math.min(5, config.digits || 2)),\r\n        questions: Math.max(0, Math.min(100, config.questions || 10)),\r\n        operation: (['addition', 'subtraction', 'multiplication', 'division', 'mixed'].includes(config.operation)\r\n          ? config.operation\r\n          : 'addition') as Operation,\r\n        divisorMin: config.divisorMin !== undefined ? Math.max(1, Math.min(100, config.divisorMin)) : 1,\r\n        divisorMax: config.divisorMax !== undefined ? Math.max(1, Math.min(100, config.divisorMax)) : 10,\r\n      }));\r\n    }\r\n\r\n    return validated;\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 391, "column": 0}, "map": {"version":3,"sources":["file:///C:/projetos/math/lib/constants/namePool.js"],"sourcesContent":["/**\r\n * Multilingual name pool for math exercises\r\n * Names selected to work well in both Portuguese and English\r\n */\r\n\r\nexport const NAME_POOL = [\r\n  // Feminine names\r\n  { name: 'Luna', gender: 'feminine' },\r\n  { name: 'Maya', gender: 'feminine' },\r\n  { name: 'Nina', gender: 'feminine' },\r\n  { name: 'Mia', gender: 'feminine' },\r\n  { name: 'Jade', gender: 'feminine' },\r\n  { name: 'Lara', gender: 'feminine' },\r\n  { name: 'Sofia', gender: 'feminine' },\r\n  { name: 'Ana', gender: 'feminine' },\r\n  { name: 'Emma', gender: 'feminine' },\r\n  \r\n  // Masculine names\r\n  { name: 'Leo', gender: 'masculine' },\r\n  { name: 'Noah', gender: 'masculine' },\r\n  { name: 'Davi', gender: 'masculine' },\r\n  { name: 'Kai', gender: 'masculine' },\r\n  { name: 'Lucas', gender: 'masculine' },\r\n  { name: 'Theo', gender: 'masculine' },\r\n  { name: 'Samuel', gender: 'masculine' },\r\n  { name: 'Enzo', gender: 'masculine' },\r\n  { name: 'Miguel', gender: 'masculine' },\r\n];\r\n\r\n/**\r\n * Gets a random name from the pool\r\n * @param {string} [gender] - Filter by gender (optional: 'feminine' or 'masculine')\r\n * @param {number} [seed] - Seed for deterministic randomization (optional)\r\n * @returns {string} Selected name\r\n */\r\nexport function getRandomName(gender, seed) {\r\n  const filteredPool = gender \r\n    ? NAME_POOL.filter(n => n.gender === gender)\r\n    : NAME_POOL;\r\n  \r\n  if (seed !== undefined) {\r\n    // Deterministic randomization using seed\r\n    const index = seed % filteredPool.length;\r\n    return filteredPool[index].name;\r\n  }\r\n  \r\n  // True randomization\r\n  const randomIndex = Math.floor(Math.random() * filteredPool.length);\r\n  return filteredPool[randomIndex].name;\r\n}\r\n\r\n/**\r\n * Gets multiple unique names\r\n * @param {number} count - Number of names to return\r\n * @param {string} [gender] - Filter by gender (optional)\r\n * @returns {string[]} Array of unique names\r\n */\r\nexport function getRandomNames(count, gender) {\r\n  const filteredPool = gender \r\n    ? NAME_POOL.filter(n => n.gender === gender)\r\n    : NAME_POOL;\r\n  \r\n  const shuffled = [...filteredPool].sort(() => Math.random() - 0.5);\r\n  return shuffled.slice(0, Math.min(count, shuffled.length)).map(n => n.name);\r\n}\r\n\r\n/**\r\n * Gets a consistent name based on an ID/hash\r\n * Useful for maintaining the same name across an exercise set\r\n * @param {string|number} id - Unique identifier\r\n * @param {string} [gender] - Filter by gender (optional)\r\n * @returns {string} Consistent name for the provided ID\r\n */\r\nexport function getConsistentName(id, gender) {\r\n  const filteredPool = gender \r\n    ? NAME_POOL.filter(n => n.gender === gender)\r\n    : NAME_POOL;\r\n  \r\n  // Generate simple hash from ID\r\n  const hash = typeof id === 'string' \r\n    ? id.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0)\r\n    : id;\r\n  \r\n  const index = hash % filteredPool.length;\r\n  return filteredPool[index].name;\r\n}\r\n\r\n/**\r\n * Gets all names as comma-separated string\r\n * Useful for AI prompts\r\n * @returns {string}\r\n */\r\nexport function getAllNamesString() {\r\n  return NAME_POOL.map(n => n.name).join(', ');\r\n}\r\n\r\n/**\r\n * Checks if text contains any name from the pool\r\n * @param {string} text - Text to check\r\n * @returns {boolean} true if contains any name from the pool\r\n */\r\nexport function containsAnyName(text) {\r\n  const lowerText = text.toLowerCase();\r\n  return NAME_POOL.some(n => lowerText.includes(n.name.toLowerCase()));\r\n}\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;;;;;;;;;AAEM,MAAM,YAAY;IACvB,iBAAiB;IACjB;QAAE,MAAM;QAAQ,QAAQ;IAAW;IACnC;QAAE,MAAM;QAAQ,QAAQ;IAAW;IACnC;QAAE,MAAM;QAAQ,QAAQ;IAAW;IACnC;QAAE,MAAM;QAAO,QAAQ;IAAW;IAClC;QAAE,MAAM;QAAQ,QAAQ;IAAW;IACnC;QAAE,MAAM;QAAQ,QAAQ;IAAW;IACnC;QAAE,MAAM;QAAS,QAAQ;IAAW;IACpC;QAAE,MAAM;QAAO,QAAQ;IAAW;IAClC;QAAE,MAAM;QAAQ,QAAQ;IAAW;IAEnC,kBAAkB;IAClB;QAAE,MAAM;QAAO,QAAQ;IAAY;IACnC;QAAE,MAAM;QAAQ,QAAQ;IAAY;IACpC;QAAE,MAAM;QAAQ,QAAQ;IAAY;IACpC;QAAE,MAAM;QAAO,QAAQ;IAAY;IACnC;QAAE,MAAM;QAAS,QAAQ;IAAY;IACrC;QAAE,MAAM;QAAQ,QAAQ;IAAY;IACpC;QAAE,MAAM;QAAU,QAAQ;IAAY;IACtC;QAAE,MAAM;QAAQ,QAAQ;IAAY;IACpC;QAAE,MAAM;QAAU,QAAQ;IAAY;CACvC;AAQM,SAAS,cAAc,MAAM,EAAE,IAAI;IACxC,MAAM,eAAe,SACjB,UAAU,MAAM,CAAC,CAAA,IAAK,EAAE,MAAM,KAAK,UACnC;IAEJ,IAAI,SAAS,WAAW;QACtB,yCAAyC;QACzC,MAAM,QAAQ,OAAO,aAAa,MAAM;QACxC,OAAO,YAAY,CAAC,MAAM,CAAC,IAAI;IACjC;IAEA,qBAAqB;IACrB,MAAM,cAAc,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,aAAa,MAAM;IAClE,OAAO,YAAY,CAAC,YAAY,CAAC,IAAI;AACvC;AAQO,SAAS,eAAe,KAAK,EAAE,MAAM;IAC1C,MAAM,eAAe,SACjB,UAAU,MAAM,CAAC,CAAA,IAAK,EAAE,MAAM,KAAK,UACnC;IAEJ,MAAM,WAAW;WAAI;KAAa,CAAC,IAAI,CAAC,IAAM,KAAK,MAAM,KAAK;IAC9D,OAAO,SAAS,KAAK,CAAC,GAAG,KAAK,GAAG,CAAC,OAAO,SAAS,MAAM,GAAG,GAAG,CAAC,CAAA,IAAK,EAAE,IAAI;AAC5E;AASO,SAAS,kBAAkB,EAAE,EAAE,MAAM;IAC1C,MAAM,eAAe,SACjB,UAAU,MAAM,CAAC,CAAA,IAAK,EAAE,MAAM,KAAK,UACnC;IAEJ,+BAA+B;IAC/B,MAAM,OAAO,OAAO,OAAO,WACvB,GAAG,KAAK,CAAC,IAAI,MAAM,CAAC,CAAC,KAAK,OAAS,MAAM,KAAK,UAAU,CAAC,IAAI,KAC7D;IAEJ,MAAM,QAAQ,OAAO,aAAa,MAAM;IACxC,OAAO,YAAY,CAAC,MAAM,CAAC,IAAI;AACjC;AAOO,SAAS;IACd,OAAO,UAAU,GAAG,CAAC,CAAA,IAAK,EAAE,IAAI,EAAE,IAAI,CAAC;AACzC;AAOO,SAAS,gBAAgB,IAAI;IAClC,MAAM,YAAY,KAAK,WAAW;IAClC,OAAO,UAAU,IAAI,CAAC,CAAA,IAAK,UAAU,QAAQ,CAAC,EAAE,IAAI,CAAC,WAAW;AAClE"}},
    {"offset": {"line": 520, "column": 0}, "map": {"version":3,"sources":["file:///C:/projetos/math/lib/generators/templateLibrary.js"],"sourcesContent":["/**\r\n * Template Library\r\n * Fallback templates for when AI is not available\r\n */\r\n\r\nimport { getRandomName } from '../constants/namePool.js';\r\n\r\nclass TemplateLibrary {\r\n  constructor() {\r\n    this.contexts = {\r\n      addition: {\r\n        fruits: [\r\n          '{name} colheu {num1} {item1} e depois colheu mais {num2} {item1}.',\r\n          'H√° {num1} {item1} em uma cesta e {num2} {item1} em outra cesta.',\r\n          '{name} ganhou {num1} {item1} de sua av√≥ e {num2} {item1} de seu tio.'\r\n        ],\r\n        toys: [\r\n          '{name} tem {num1} {item1} e ganhou mais {num2} {item1}.',\r\n          'No quarto de {name} h√° {num1} {item1} e ela comprou mais {num2} {item1}.',\r\n          '{name} organizou {num1} {item1} em uma prateleira e {num2} {item1} em outra.'\r\n        ],\r\n        animals: [\r\n          'No jardim, {name} viu {num1} {item1} pela manh√£ e {num2} {item1} √† tarde.',\r\n          '{name} contou {num1} {item1} em uma √°rvore e {num2} {item1} em outra.',\r\n          'No parque h√° {num1} {item1} e chegaram mais {num2} {item1}.'\r\n        ],\r\n        school: [\r\n          '{name} tem {num1} {item1} e sua amiga emprestou {num2} {item1}.',\r\n          'Na mochila de {name} h√° {num1} {item1} e ela colocou mais {num2} {item1}.',\r\n          '{name} organizou {num1} {item1} na estante e depois mais {num2} {item1}.'\r\n        ]\r\n      },\r\n      subtraction: {\r\n        fruits: [\r\n          '{name} tinha {num1} {item1} e comeu {num2} {item1}.',\r\n          'Havia {num1} {item1} na fruteira e {name} pegou {num2} {item1}.',\r\n          '{name} colheu {num1} {item1} e deu {num2} {item1} para sua irm√£.'\r\n        ],\r\n        toys: [\r\n          '{name} tinha {num1} {item1} e doou {num2} {item1}.',\r\n          'No quarto havia {num1} {item1} e {name} guardou {num2} {item1}.',\r\n          '{name} tinha {num1} {item1} e perdeu {num2} {item1}.'\r\n        ],\r\n        animals: [\r\n          '{name} viu {num1} {item1} no jardim e {num2} {item1} voaram.',\r\n          'Havia {num1} {item1} no lago e {num2} {item1} nadaram para longe.',\r\n          'No parque tinha {num1} {item1} e {num2} {item1} foram embora.'\r\n        ],\r\n        school: [\r\n          '{name} tinha {num1} {item1} e emprestou {num2} {item1} para um amigo.',\r\n          'Na mochila havia {num1} {item1} e {name} usou {num2} {item1}.',\r\n          '{name} tinha {num1} {item1} e deu {num2} {item1} para seu professor.'\r\n        ]\r\n      }\r\n    };\r\n\r\n    this.items = {\r\n      fruits: ['ma√ß√£s üçé', 'morangos üçì', 'bananas üçå', 'laranjas üçä', 'uvas üçá'],\r\n      toys: ['carrinhos üöó', 'bonecas üéÄ', 'bolas ‚öΩ', 'blocos üß±', 'ursinhos üß∏'],\r\n      animals: ['borboletas ü¶ã', 'passarinhos üê¶', 'coelhos üê∞', 'gatinhos üê±', 'cachorrinhos üê∂'],\r\n      school: ['l√°pis ‚úèÔ∏è', 'livros üìö', 'cadernos üìì', 'canetas üñäÔ∏è', 'borrachas']\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Selects a random item from an array\r\n   */\r\n  randomChoice(array) {\r\n    return array[Math.floor(Math.random() * array.length)];\r\n  }\r\n\r\n  /**\r\n   * Generates a context for a problem\r\n   */\r\n  getContext(operation, num1, num2) {\r\n    // Get a random name from the pool\r\n    const name = getRandomName();\r\n\r\n    // Select random category\r\n    const categories = Object.keys(this.contexts[operation]);\r\n    const category = this.randomChoice(categories);\r\n\r\n    // Select random template\r\n    const templates = this.contexts[operation][category];\r\n    const template = this.randomChoice(templates);\r\n\r\n    // Select random item\r\n    const items = this.items[category];\r\n    const item = this.randomChoice(items);\r\n\r\n    // Replace placeholders\r\n    const context = template\r\n      .replace(/{name}/g, name)\r\n      .replace(/{num1}/g, num1)\r\n      .replace(/{num2}/g, num2)\r\n      .replace(/{item1}/g, item);\r\n\r\n    return context;\r\n  }\r\n\r\n  /**\r\n   * Generates a complete contextualized problem\r\n   */\r\n  generateWordProblem(problem) {\r\n    const context = this.getContext(problem.type, problem.num1, problem.num2);\r\n    \r\n    const question = problem.type === 'addition' \r\n      ? 'Quantos no total?'\r\n      : 'Quantos restaram?';\r\n\r\n    return {\r\n      context,\r\n      question,\r\n      answer: problem.answer\r\n    };\r\n  }\r\n}\r\n\r\nexport default TemplateLibrary;\r\n"],"names":[],"mappings":";;;;AAAA;;;CAGC,GAED;;AAEA,MAAM;IACJ,aAAc;QACZ,IAAI,CAAC,QAAQ,GAAG;YACd,UAAU;gBACR,QAAQ;oBACN;oBACA;oBACA;iBACD;gBACD,MAAM;oBACJ;oBACA;oBACA;iBACD;gBACD,SAAS;oBACP;oBACA;oBACA;iBACD;gBACD,QAAQ;oBACN;oBACA;oBACA;iBACD;YACH;YACA,aAAa;gBACX,QAAQ;oBACN;oBACA;oBACA;iBACD;gBACD,MAAM;oBACJ;oBACA;oBACA;iBACD;gBACD,SAAS;oBACP;oBACA;oBACA;iBACD;gBACD,QAAQ;oBACN;oBACA;oBACA;iBACD;YACH;QACF;QAEA,IAAI,CAAC,KAAK,GAAG;YACX,QAAQ;gBAAC;gBAAY;gBAAe;gBAAc;gBAAe;aAAU;YAC3E,MAAM;gBAAC;gBAAgB;gBAAc;gBAAW;gBAAa;aAAc;YAC3E,SAAS;gBAAC;gBAAiB;gBAAkB;gBAAc;gBAAe;aAAkB;YAC5F,QAAQ;gBAAC;gBAAY;gBAAa;gBAAe;gBAAe;aAAY;QAC9E;IACF;IAEA;;GAEC,GACD,aAAa,KAAK,EAAE;QAClB,OAAO,KAAK,CAAC,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,MAAM,MAAM,EAAE;IACxD;IAEA;;GAEC,GACD,WAAW,SAAS,EAAE,IAAI,EAAE,IAAI,EAAE;QAChC,kCAAkC;QAClC,MAAM,OAAO,IAAA,6IAAa;QAE1B,yBAAyB;QACzB,MAAM,aAAa,OAAO,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,UAAU;QACvD,MAAM,WAAW,IAAI,CAAC,YAAY,CAAC;QAEnC,yBAAyB;QACzB,MAAM,YAAY,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,SAAS;QACpD,MAAM,WAAW,IAAI,CAAC,YAAY,CAAC;QAEnC,qBAAqB;QACrB,MAAM,QAAQ,IAAI,CAAC,KAAK,CAAC,SAAS;QAClC,MAAM,OAAO,IAAI,CAAC,YAAY,CAAC;QAE/B,uBAAuB;QACvB,MAAM,UAAU,SACb,OAAO,CAAC,WAAW,MACnB,OAAO,CAAC,WAAW,MACnB,OAAO,CAAC,WAAW,MACnB,OAAO,CAAC,YAAY;QAEvB,OAAO;IACT;IAEA;;GAEC,GACD,oBAAoB,OAAO,EAAE;QAC3B,MAAM,UAAU,IAAI,CAAC,UAAU,CAAC,QAAQ,IAAI,EAAE,QAAQ,IAAI,EAAE,QAAQ,IAAI;QAExE,MAAM,WAAW,QAAQ,IAAI,KAAK,aAC9B,sBACA;QAEJ,OAAO;YACL;YACA;YACA,QAAQ,QAAQ,MAAM;QACxB;IACF;AACF;uCAEe"}},
    {"offset": {"line": 648, "column": 0}, "map": {"version":3,"sources":["file:///C:/projetos/math/lib/generators/aiEnhancer.js"],"sourcesContent":["/**\r\n * AI Enhancer - Google Gemini Integration\r\n * Generates diverse narrative contexts for math problems\r\n */\r\n\r\nimport { GoogleGenerativeAI } from '@google/generative-ai';\r\nimport TemplateLibrary from './templateLibrary.js';\r\nimport { getRandomName, getAllNamesString, containsAnyName } from '../constants/namePool.js';\r\n\r\nclass AIEnhancer {\r\n  constructor(apiKey, options = {}) {\r\n    this.apiKey = apiKey;\r\n    this.enabled = !!apiKey;\r\n    this.templateLibrary = new TemplateLibrary();\r\n    this.options = {\r\n      model: options.model || 'gemini-flash-latest',\r\n      maxRetries: options.maxRetries || 3,\r\n      temperature: options.temperature || 0.7,\r\n      baseDelay: options.baseDelay || 1000, // 1 second base\r\n      maxDelay: options.maxDelay || 60000, // 60 seconds maximum\r\n      requestsPerMinute: options.requestsPerMinute || 10, // Conservative limit\r\n      ...options\r\n    };\r\n    \r\n    // Rate limiting control\r\n    this.lastRequestTime = 0;\r\n    this.requestCount = 0;\r\n    this.quotaExceeded = false;\r\n    this.quotaResetTime = null;\r\n\r\n    if (this.enabled) {\r\n      this.genAI = new GoogleGenerativeAI(apiKey);\r\n      this.model = this.genAI.getGenerativeModel({ \r\n        model: this.options.model \r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates a structured prompt for Gemini\r\n   */\r\n  createPrompt(problem, characterName = null) {\r\n    const name = characterName || getRandomName();\r\n    const operation = problem.type === 'addition' ? 'adi√ß√£o' : 'subtra√ß√£o';\r\n    const action = problem.type === 'addition' \r\n      ? 'juntar, ganhar, somar' \r\n      : 'tirar, dar, perder, usar';\r\n\r\n    return `Voc√™ √© um assistente educacional criando problemas de matem√°tica para crian√ßas brasileiras.\r\n\r\nCONTEXTO DO PROBLEMA:\r\n- Opera√ß√£o: ${operation} (${problem.num1} ${problem.operation} ${problem.num2})\r\n- Resposta: ${problem.answer}\r\n- Personagem: ${name} (crian√ßa brasileira, 7-9 anos)\r\n\r\nREGRAS ESTRITAS:\r\n1. Use APENAS portugu√™s brasileiro informal e acolhedor\r\n2. Crie UMA √∫nica frase curta (m√°ximo 20 palavras) sobre ${name}\r\n3. Use a√ß√µes relacionadas a: ${action}\r\n4. Tom POSITIVO e ALEGRE\r\n5. Contextos permitidos: brinquedos, frutas, material escolar, animais fofos, natureza\r\n6. DEVE incluir os n√∫meros ${problem.num1} e ${problem.num2} na hist√≥ria\r\n7. N√ÉO inclua a opera√ß√£o matem√°tica (+, ‚àí, =)\r\n8. N√ÉO inclua perguntas ou respostas\r\n9. N√ÉO use palavras negativas: triste, perdeu (se evit√°vel), quebrou, machucou\r\n\r\nTEMAS SUGERIDOS:\r\nüé® Brinquedos: carrinhos, bonecas, blocos, bolas, ursinhos\r\nüçé Frutas: ma√ß√£s, morangos, bananas, laranjas\r\nüìö Escola: l√°pis, livros, cadernos, figurinhas\r\nü¶ã Animais: borboletas, passarinhos, coelhos, gatinhos\r\nüå∏ Natureza: flores, estrelas, √°rvores\r\n\r\nEXEMPLOS DE SA√çDA:\r\n\"${name} tinha ${problem.num1} figurinhas e ganhou mais ${problem.num2} figurinhas da amiga.\"\r\n\"${name} tem ${problem.num1} l√°pis de cor e comprou ${problem.num2} l√°pis novos.\"\r\n\"${name} colheu ${problem.num1} morangos no jardim e deu ${problem.num2} morangos para a vov√≥.\"\r\n\r\nAgora crie APENAS a frase narrativa com o personagem ${name} (usando os n√∫meros ${problem.num1} e ${problem.num2}):`;\r\n  }\r\n\r\n  /**\r\n   * Creates a batch prompt for multiple problems\r\n   */\r\n  createBatchPrompt(problems, characterNames = []) {\r\n    const namesUsed = characterNames.length > 0 ? characterNames : problems.map(() => getRandomName());\r\n    const namesString = getAllNamesString();\r\n    \r\n    return `Voc√™ √© um assistente educacional criando problemas de matem√°tica para crian√ßas brasileiras.\r\n\r\nCONTEXTO GERAL:\r\n- Use APENAS estes nomes de personagens: ${namesString}\r\n- Para cada problema, use o nome especificado\r\n- Temas: brinquedos, frutas, material escolar, animais fofos, natureza\r\n\r\nREGRAS ESTRITAS:\r\n1. Use APENAS portugu√™s brasileiro informal e acolhedor\r\n2. Crie UMA √∫nica frase curta (m√°ximo 20 palavras) para CADA problema\r\n3. Tom POSITIVO e ALEGRE\r\n4. DEVE incluir os n√∫meros espec√≠ficos na hist√≥ria\r\n5. N√ÉO inclua opera√ß√£o matem√°tica (+, ‚àí, =)\r\n6. N√ÉO inclua perguntas ou respostas\r\n7. N√ÉO use palavras negativas: triste, perdeu (se evit√°vel), quebrou, machucou\r\n8. VARIE os temas entre os problemas (n√£o repita contextos similares)\r\n\r\nCrie uma frase narrativa para CADA um dos ${problems.length} problemas abaixo.\r\nRetorne APENAS as frases, uma por linha, numeradas de 1 a ${problems.length}:\r\n\r\n${problems.map((p, i) => {\r\n  const operation = p.type === 'addition' ? 'adi√ß√£o' : 'subtra√ß√£o';\r\n  const action = p.type === 'addition' ? 'ganhar/juntar' : 'dar/usar';\r\n  return `${i + 1}. Opera√ß√£o: ${operation} (${p.num1} ${p.operation} ${p.num2}) - A√ß√£o: ${action}`;\r\n}).join('\\n')}\r\n\r\nFORMATO DE SA√çDA OBRIGAT√ìRIO:\r\n1. [frase para o problema 1]\r\n2. [frase para o problema 2]\r\n3. [frase para o problema 3]\r\n... e assim por diante`;\r\n  }\r\n\r\n  /**\r\n   * Waits minimum interval between requests to respect rate limits\r\n   */\r\n  async waitForRateLimit() {\r\n    const now = Date.now();\r\n    const minInterval = (60 * 1000) / this.options.requestsPerMinute; // Minimum interval between requests\r\n    const timeSinceLastRequest = now - this.lastRequestTime;\r\n    \r\n    if (timeSinceLastRequest < minInterval) {\r\n      const waitTime = minInterval - timeSinceLastRequest;\r\n      await this.sleep(waitTime);\r\n    }\r\n    \r\n    this.lastRequestTime = Date.now();\r\n  }\r\n\r\n  /**\r\n   * Extracts retry time from 429 error message\r\n   */\r\n  extractRetryTime(errorMessage) {\r\n    // Try to extract seconds \"retry in 57.247271744s\" or \"Please retry in 57s\"\r\n    const secondsMatch = errorMessage.match(/retry in (\\d+(?:\\.\\d+)?)\\s*s/i);\r\n    if (secondsMatch) {\r\n      return Date.now() + (parseFloat(secondsMatch[1]) * 1000);\r\n    }\r\n    \r\n    // Default: 60 seconds\r\n    return Date.now() + 60000;\r\n  }\r\n\r\n  /**\r\n   * Generates a context using AI with retry and exponential backoff\r\n   */\r\n  async generateContext(problem) {\r\n    if (!this.enabled) {\r\n      return this.templateLibrary.getContext(problem.type, problem.num1, problem.num2);\r\n    }\r\n\r\n    // If quota exceeded, check if reset time has passed\r\n    if (this.quotaExceeded && this.quotaResetTime) {\r\n      const now = Date.now();\r\n      if (now < this.quotaResetTime) {\r\n        const waitSeconds = Math.ceil((this.quotaResetTime - now) / 1000);\r\n        console.warn(`‚ö†Ô∏è  Quota exceeded. Reset in ${waitSeconds}s. Using template.`);\r\n        return this.templateLibrary.getContext(problem.type, problem.num1, problem.num2);\r\n      } else {\r\n        // Reset quota\r\n        this.quotaExceeded = false;\r\n        this.quotaResetTime = null;\r\n      }\r\n    }\r\n\r\n    let lastError = null;\r\n    \r\n    for (let attempt = 0; attempt < this.options.maxRetries; attempt++) {\r\n      try {\r\n        // Rate limiting: wait between requests\r\n        await this.waitForRateLimit();\r\n        \r\n        const prompt = this.createPrompt(problem);\r\n        const result = await this.model.generateContent(prompt);\r\n        const response = await result.response;\r\n        let text = response.text().trim();\r\n\r\n        // Remove quotes if they exist\r\n        text = text.replace(/^[\"']|[\"']$/g, '');\r\n\r\n        // Increment successful requests counter\r\n        this.requestCount++;\r\n\r\n        if (this.validateContext(text)) {\r\n          return text;\r\n        } else {\r\n          return this.templateLibrary.getContext(problem.type, problem.num1, problem.num2);\r\n        }\r\n\r\n      } catch (error) {\r\n        lastError = error;\r\n        const errorMessage = error.message || '';\r\n        \r\n        // Check if it's a rate limit error (429) or quota exceeded\r\n        if (errorMessage.includes('429') || errorMessage.includes('Too Many Requests') || errorMessage.includes('Quota exceeded')) {\r\n          this.quotaResetTime = this.extractRetryTime(errorMessage);\r\n          this.quotaExceeded = true;\r\n          return this.templateLibrary.getContext(problem.type, problem.num1, problem.num2);\r\n        }\r\n        \r\n        // For other errors, retry with exponential backoff\r\n        if (attempt < this.options.maxRetries - 1) {\r\n          const delay = Math.min(\r\n            this.options.baseDelay * Math.pow(2, attempt),\r\n            this.options.maxDelay\r\n          );\r\n          await this.sleep(delay);\r\n        }\r\n      }\r\n    }\r\n    \r\n    return this.templateLibrary.getContext(problem.type, problem.num1, problem.num2);\r\n  }\r\n\r\n  /**\r\n   * Generates contexts for multiple problems in a single request\r\n   */\r\n  async generateContextsBatch(problems) {\r\n    if (!this.enabled || this.quotaExceeded) {\r\n      return problems.map(p => this.templateLibrary.getContext(p.type, p.num1, p.num2));\r\n    }\r\n\r\n    let lastError = null;\r\n\r\n    for (let attempt = 0; attempt < this.options.maxRetries; attempt++) {\r\n      try {\r\n        await this.waitForRateLimit();\r\n        \r\n        const prompt = this.createBatchPrompt(problems);\r\n        const result = await this.model.generateContent(prompt);\r\n        const response = await result.response;\r\n        let text = response.text().trim();\r\n\r\n        this.requestCount++;\r\n\r\n        // Parse das linhas numeradas\r\n        const lines = text.split('\\n').filter(line => line.trim());\r\n        const contexts = [];\r\n\r\n        for (let i = 0; i < problems.length; i++) {\r\n          let context = null;\r\n          \r\n          // Tentar encontrar linha correspondente\r\n          const linePattern = new RegExp(`^\\\\s*${i + 1}[\\\\.)\\\\-:]\\\\s*(.+)$`);\r\n          const matchingLine = lines.find(line => linePattern.test(line));\r\n          \r\n          if (matchingLine) {\r\n            const match = matchingLine.match(linePattern);\r\n            context = match[1].trim().replace(/^[\"']|[\"']$/g, '');\r\n          } else if (lines[i]) {\r\n            // Fallback: usar linha por √≠ndice\r\n            context = lines[i].replace(/^\\d+[\\.)\\-:]\\s*/, '').trim().replace(/^[\"']|[\"']$/g, '');\r\n          }\r\n\r\n          // Validar contexto\r\n          if (context && this.validateContext(context)) {\r\n            contexts.push(context);\r\n          } else {\r\n            // Use template if validation fails\r\n            const p = problems[i];\r\n            contexts.push(this.templateLibrary.getContext(p.type, p.num1, p.num2));\r\n          }\r\n        }\r\n\r\n        return contexts;\r\n\r\n      } catch (error) {\r\n        lastError = error;\r\n        const errorMessage = error.message || '';\r\n        \r\n        if (errorMessage.includes('429') || errorMessage.includes('Too Many Requests') || errorMessage.includes('Quota exceeded')) {\r\n          this.quotaResetTime = this.extractRetryTime(errorMessage);\r\n          this.quotaExceeded = true;\r\n          return problems.map(p => this.templateLibrary.getContext(p.type, p.num1, p.num2));\r\n        }\r\n        \r\n        if (attempt < this.options.maxRetries - 1) {\r\n          const delay = Math.min(\r\n            this.options.baseDelay * Math.pow(2, attempt),\r\n            this.options.maxDelay\r\n          );\r\n          await this.sleep(delay);\r\n        }\r\n      }\r\n    }\r\n    \r\n    return problems.map(p => this.templateLibrary.getContext(p.type, p.num1, p.num2));\r\n  }\r\n\r\n  /**\r\n   * Validates if the generated context is appropriate\r\n   */\r\n  validateContext(text) {\r\n    // Check length\r\n    if (!text || text.length < 10 || text.length > 200) {\r\n      return false;\r\n    }\r\n\r\n    // Inappropriate words\r\n    const inappropriate = [\r\n      'morte', 'morrer', 'matar', 'viol√™ncia', 'sangue',\r\n      'medo', 'terror', 'horror', 'dor', 'doer', 'machucar',\r\n      'feio', 'horr√≠vel', 'p√©ssimo', 'ruim'\r\n    ];\r\n\r\n    const lowerText = text.toLowerCase();\r\n    if (inappropriate.some(word => lowerText.includes(word))) {\r\n      return false;\r\n    }\r\n\r\n    // Check if it doesn't contain explicit numbers (avoid \"3 + 2\")\r\n    if (/\\d+\\s*[+\\-√ó√∑]\\s*\\d+/.test(text)) {\r\n      return false;\r\n    }\r\n\r\n    // Check if contains any name from the pool\r\n    if (!containsAnyName(text)) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Generates complete contextualized problem\r\n   */\r\n  async generateWordProblem(problem) {\r\n    const context = await this.generateContext(problem);\r\n    \r\n    const question = problem.type === 'addition' \r\n      ? 'Quantos no total?'\r\n      : 'Quantos restaram?';\r\n\r\n    return {\r\n      context,\r\n      question,\r\n      numbers: `${problem.num1} ${problem.operation} ${problem.num2} = ____`,\r\n      answer: problem.answer\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Generates multiple contexts in batch with internally managed rate limiting\r\n   */\r\n  async generateBatch(problems) {\r\n    const contexts = [];\r\n\r\n    for (const problem of problems) {\r\n      const context = await this.generateContext(problem);\r\n      contexts.push(context);\r\n      // Rate limiting is now managed internally by waitForRateLimit\r\n    }\r\n\r\n    return contexts;\r\n  }\r\n\r\n  /**\r\n   * Returns API usage statistics\r\n   */\r\n  getUsageStats() {\r\n    return {\r\n      requestCount: this.requestCount,\r\n      quotaExceeded: this.quotaExceeded,\r\n      quotaResetTime: this.quotaResetTime,\r\n      requestsPerMinute: this.options.requestsPerMinute\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Helper for delay\r\n   */\r\n  sleep(ms) {\r\n    return new Promise(resolve => setTimeout(resolve, ms));\r\n  }\r\n\r\n  /**\r\n   * Checks if AI is available\r\n   */\r\n  isEnabled() {\r\n    return this.enabled;\r\n  }\r\n\r\n  /**\r\n   * Fallback to templates\r\n   */\r\n  getFallbackContext(problem) {\r\n    return this.templateLibrary.getContext(problem.type, problem.num1, problem.num2);\r\n  }\r\n}\r\n\r\nexport default AIEnhancer;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 995, "column": 0}, "map": {"version":3,"sources":["file:///C:/projetos/math/lib/utils/cache.js"],"sourcesContent":["/**\r\n * Sistema de Cache para respostas da IA\r\n * Evita chamadas repetidas e melhora performance\r\n */\r\n\r\nimport { promises as fs } from 'fs';\r\nimport path from 'path';\r\n\r\nclass CacheManager {\r\n  constructor(cacheDir = './cache') {\r\n    this.cacheDir = cacheDir;\r\n    this.memoryCache = new Map();\r\n  }\r\n\r\n  /**\r\n   * Inicializa o sistema de cache\r\n   */\r\n  async init() {\r\n    try {\r\n      await fs.mkdir(this.cacheDir, { recursive: true });\r\n      console.log('‚úÖ Sistema de cache inicializado');\r\n    } catch (error) {\r\n      console.warn('‚ö†Ô∏è  Erro ao criar diret√≥rio de cache:', error.message);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gera uma chave √∫nica para o problema\r\n   */\r\n  getCacheKey(problem) {\r\n    return `${problem.type}-${problem.num1}-${problem.num2}`;\r\n  }\r\n\r\n  /**\r\n   * Gera o caminho do arquivo de cache\r\n   */\r\n  getCacheFilePath(key) {\r\n    // Criar subdiret√≥rio por tipo de opera√ß√£o\r\n    const type = key.split('-')[0];\r\n    return path.join(this.cacheDir, type, `${key}.json`);\r\n  }\r\n\r\n  /**\r\n   * Busca no cache (mem√≥ria primeiro, depois arquivo)\r\n   */\r\n  async get(problem) {\r\n    const key = this.getCacheKey(problem);\r\n\r\n    // Tentar mem√≥ria primeiro\r\n    if (this.memoryCache.has(key)) {\r\n      return this.memoryCache.get(key);\r\n    }\r\n\r\n    // Tentar arquivo\r\n    try {\r\n      const filePath = this.getCacheFilePath(key);\r\n      const data = await fs.readFile(filePath, 'utf-8');\r\n      const cached = JSON.parse(data);\r\n\r\n      // Adicionar √† mem√≥ria\r\n      this.memoryCache.set(key, cached.context);\r\n\r\n      return cached.context;\r\n    } catch (error) {\r\n      // N√£o encontrado no cache\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Salva no cache (mem√≥ria e arquivo)\r\n   */\r\n  async set(problem, context) {\r\n    const key = this.getCacheKey(problem);\r\n\r\n    // Salvar na mem√≥ria\r\n    this.memoryCache.set(key, context);\r\n\r\n    // Salvar em arquivo\r\n    try {\r\n      const filePath = this.getCacheFilePath(key);\r\n      const dir = path.dirname(filePath);\r\n\r\n      // Criar diret√≥rio se n√£o existir\r\n      await fs.mkdir(dir, { recursive: true });\r\n\r\n      // Salvar dados\r\n      const data = {\r\n        key,\r\n        context,\r\n        problem: {\r\n          type: problem.type,\r\n          num1: problem.num1,\r\n          num2: problem.num2,\r\n          operation: problem.operation,\r\n          answer: problem.answer\r\n        },\r\n        timestamp: new Date().toISOString(),\r\n        version: '1.0'\r\n      };\r\n\r\n      await fs.writeFile(filePath, JSON.stringify(data, null, 2), 'utf-8');\r\n    } catch (error) {\r\n      console.warn(`‚ö†Ô∏è  Erro ao salvar cache para ${key}:`, error.message);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Verifica se existe no cache\r\n   */\r\n  async has(problem) {\r\n    const key = this.getCacheKey(problem);\r\n    \r\n    if (this.memoryCache.has(key)) {\r\n      return true;\r\n    }\r\n\r\n    try {\r\n      const filePath = this.getCacheFilePath(key);\r\n      await fs.access(filePath);\r\n      return true;\r\n    } catch {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Obt√©m estat√≠sticas do cache\r\n   */\r\n  async getStats() {\r\n    try {\r\n      const stats = {\r\n        memorySize: this.memoryCache.size,\r\n        fileCount: 0,\r\n        totalSize: 0,\r\n        byType: {}\r\n      };\r\n\r\n      // Contar arquivos por tipo\r\n      for (const type of ['addition', 'subtraction']) {\r\n        const typeDir = path.join(this.cacheDir, type);\r\n        try {\r\n          const files = await fs.readdir(typeDir);\r\n          stats.byType[type] = files.length;\r\n          stats.fileCount += files.length;\r\n\r\n          // Calcular tamanho total\r\n          for (const file of files) {\r\n            const filePath = path.join(typeDir, file);\r\n            const stat = await fs.stat(filePath);\r\n            stats.totalSize += stat.size;\r\n          }\r\n        } catch {\r\n          stats.byType[type] = 0;\r\n        }\r\n      }\r\n\r\n      return stats;\r\n    } catch (error) {\r\n      return { error: error.message };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Limpa o cache\r\n   */\r\n  async clear() {\r\n    // Limpar mem√≥ria\r\n    this.memoryCache.clear();\r\n\r\n    // Limpar arquivos\r\n    try {\r\n      await fs.rm(this.cacheDir, { recursive: true, force: true });\r\n      await fs.mkdir(this.cacheDir, { recursive: true });\r\n      console.log('‚úÖ Cache limpo com sucesso');\r\n    } catch (error) {\r\n      console.warn('‚ö†Ô∏è  Erro ao limpar cache:', error.message);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Pr√©-aquece o cache com problemas comuns\r\n   */\r\n  async warmup(aiEnhancer, ranges = { min: 1, max: 20 }) {\r\n    console.log('üî• Aquecendo cache...');\r\n    \r\n    const operations = ['addition', 'subtraction'];\r\n    let generated = 0;\r\n    let cached = 0;\r\n\r\n    for (const type of operations) {\r\n      for (let i = ranges.min; i <= ranges.max; i++) {\r\n        for (let j = ranges.min; j <= ranges.max; j++) {\r\n          const problem = {\r\n            type,\r\n            num1: i,\r\n            num2: j,\r\n            operation: type === 'addition' ? '+' : '‚àí',\r\n            answer: type === 'addition' ? i + j : i - j\r\n          };\r\n\r\n          // Verificar se j√° existe\r\n          const exists = await this.has(problem);\r\n          if (!exists) {\r\n            const context = await aiEnhancer.generateContext(problem);\r\n            await this.set(problem, context);\r\n            generated++;\r\n\r\n            // Pequeno delay para respeitar rate limits\r\n            await this.sleep(100);\r\n          } else {\r\n            cached++;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    console.log(`‚úÖ Cache aquecido: ${generated} novos, ${cached} existentes`);\r\n    \r\n    return { generated, cached };\r\n  }\r\n\r\n  /**\r\n   * Helper para delay\r\n   */\r\n  sleep(ms) {\r\n    return new Promise(resolve => setTimeout(resolve, ms));\r\n  }\r\n\r\n  /**\r\n   * Carrega todos os itens do cache para mem√≥ria\r\n   */\r\n  async loadToMemory() {\r\n    console.log('üì• Carregando cache para mem√≥ria...');\r\n    let count = 0;\r\n\r\n    try {\r\n      for (const type of ['addition', 'subtraction']) {\r\n        const typeDir = path.join(this.cacheDir, type);\r\n        try {\r\n          const files = await fs.readdir(typeDir);\r\n          \r\n          for (const file of files) {\r\n            if (file.endsWith('.json')) {\r\n              const filePath = path.join(typeDir, file);\r\n              const data = await fs.readFile(filePath, 'utf-8');\r\n              const cached = JSON.parse(data);\r\n              \r\n              this.memoryCache.set(cached.key, cached.context);\r\n              count++;\r\n            }\r\n          }\r\n        } catch {\r\n          // Diret√≥rio n√£o existe ou est√° vazio\r\n        }\r\n      }\r\n\r\n      console.log(`‚úÖ ${count} itens carregados na mem√≥ria`);\r\n    } catch (error) {\r\n      console.warn('‚ö†Ô∏è  Erro ao carregar cache:', error.message);\r\n    }\r\n\r\n    return count;\r\n  }\r\n}\r\n\r\nexport default CacheManager;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1246, "column": 0}, "map": {"version":3,"sources":["file:///C:/projetos/math/lib/services/AIEnhancerService.js"],"sourcesContent":["/**\r\n * Servi√ßo para gera√ß√£o de contextos narrativos com IA\r\n * Encapsula a l√≥gica de neg√≥cio do AIEnhancer\r\n */\r\n\r\nimport AIEnhancer from '../generators/aiEnhancer.js';\r\nimport CacheManager from '../utils/cache.js';\r\n\r\nexport class AIEnhancerService {\r\n  /**\r\n   * Generate problems with context\r\n   * @param {Array} problems - Lista de problemas matem√°ticos\r\n   * @param {number} count - Quantidade de problemas a contextualizar\r\n   * @returns {Promise<Array>} - Problemas contextualizados\r\n   */\r\n  static async generateContextualProblems(problems, count = 10) {\r\n    const apiKey = process.env.GEMINI_API_KEY;\r\n    \r\n    if (!apiKey || apiKey === 'your_api_key_here') {\r\n      throw new Error('API key do Gemini n√£o configurada');\r\n    }\r\n\r\n    const aiEnhancer = new AIEnhancer(apiKey, {\r\n      model: process.env.GEMINI_MODEL || 'gemini-2.0-flash-exp',\r\n    });\r\n\r\n    const cacheManager = new CacheManager('./cache');\r\n    await cacheManager.init();\r\n    await cacheManager.loadToMemory();\r\n\r\n    // Selecionar problemas para contextualizar\r\n    const selectedProblems = this.selectProblems(problems, count);\r\n    const contextualProblems = [];\r\n\r\n    // Separar cacheados e n√£o-cacheados\r\n    const problemsWithCache = [];\r\n    const problemsNeedingGeneration = [];\r\n\r\n    for (const problem of selectedProblems) {\r\n      const cached = await cacheManager.get(problem);\r\n      if (cached) {\r\n        problemsWithCache.push({ problem, context: cached });\r\n      } else {\r\n        problemsNeedingGeneration.push(problem);\r\n      }\r\n    }\r\n\r\n    // Gerar contextos para problemas n√£o-cacheados\r\n    let generatedContexts = [];\r\n    if (problemsNeedingGeneration.length > 0) {\r\n      generatedContexts = await aiEnhancer.generateContextsBatch(\r\n        problemsNeedingGeneration\r\n      );\r\n\r\n      // Salvar no cache\r\n      for (let i = 0; i < problemsNeedingGeneration.length; i++) {\r\n        await cacheManager.set(problemsNeedingGeneration[i], generatedContexts[i]);\r\n      }\r\n    }\r\n\r\n    // Combinar resultados mantendo ordem original\r\n    for (const problem of selectedProblems) {\r\n      const cached = problemsWithCache.find((p) => p.problem === problem);\r\n      let context;\r\n\r\n      if (cached) {\r\n        context = cached.context;\r\n      } else {\r\n        const index = problemsNeedingGeneration.indexOf(problem);\r\n        context = generatedContexts[index];\r\n      }\r\n\r\n      const question =\r\n        problem.type === 'addition' ? 'Quantos no total?' : 'Quantos restaram?';\r\n\r\n      contextualProblems.push({\r\n        context,\r\n        question,\r\n        answer: problem.answer,\r\n        num1: problem.num1,\r\n        num2: problem.num2,\r\n        operation: problem.operation,\r\n      });\r\n    }\r\n\r\n    return contextualProblems;\r\n  }\r\n\r\n  /**\r\n   * Seleciona problemas para contextualizar\r\n   * @param {Array} problems - Lista completa de problemas\r\n   * @param {number} count - Quantidade a selecionar\r\n   * @returns {Array} - Problemas selecionados\r\n   */\r\n  static selectProblems(problems, count) {\r\n    const step = Math.floor(problems.length / count);\r\n    const selected = [];\r\n\r\n    for (let i = 0; i < count && i * step < problems.length; i++) {\r\n      selected.push(problems[i * step]);\r\n    }\r\n\r\n    return selected;\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;;CAGC,GAED;AACA;;;AAEO,MAAM;IACX;;;;;GAKC,GACD,aAAa,2BAA2B,QAAQ,EAAE,QAAQ,EAAE,EAAE;QAC5D,MAAM,SAAS,QAAQ,GAAG,CAAC,cAAc;QAEzC,IAAI,CAAC,UAAU,WAAW,qBAAqB;YAC7C,MAAM,IAAI,MAAM;QAClB;QAEA,MAAM,aAAa,IAAI,0IAAU,CAAC,QAAQ;YACxC,OAAO,QAAQ,GAAG,CAAC,YAAY,IAAI;QACrC;QAEA,MAAM,eAAe,IAAI,gIAAY,CAAC;QACtC,MAAM,aAAa,IAAI;QACvB,MAAM,aAAa,YAAY;QAE/B,2CAA2C;QAC3C,MAAM,mBAAmB,IAAI,CAAC,cAAc,CAAC,UAAU;QACvD,MAAM,qBAAqB,EAAE;QAE7B,oCAAoC;QACpC,MAAM,oBAAoB,EAAE;QAC5B,MAAM,4BAA4B,EAAE;QAEpC,KAAK,MAAM,WAAW,iBAAkB;YACtC,MAAM,SAAS,MAAM,aAAa,GAAG,CAAC;YACtC,IAAI,QAAQ;gBACV,kBAAkB,IAAI,CAAC;oBAAE;oBAAS,SAAS;gBAAO;YACpD,OAAO;gBACL,0BAA0B,IAAI,CAAC;YACjC;QACF;QAEA,+CAA+C;QAC/C,IAAI,oBAAoB,EAAE;QAC1B,IAAI,0BAA0B,MAAM,GAAG,GAAG;YACxC,oBAAoB,MAAM,WAAW,qBAAqB,CACxD;YAGF,kBAAkB;YAClB,IAAK,IAAI,IAAI,GAAG,IAAI,0BAA0B,MAAM,EAAE,IAAK;gBACzD,MAAM,aAAa,GAAG,CAAC,yBAAyB,CAAC,EAAE,EAAE,iBAAiB,CAAC,EAAE;YAC3E;QACF;QAEA,8CAA8C;QAC9C,KAAK,MAAM,WAAW,iBAAkB;YACtC,MAAM,SAAS,kBAAkB,IAAI,CAAC,CAAC,IAAM,EAAE,OAAO,KAAK;YAC3D,IAAI;YAEJ,IAAI,QAAQ;gBACV,UAAU,OAAO,OAAO;YAC1B,OAAO;gBACL,MAAM,QAAQ,0BAA0B,OAAO,CAAC;gBAChD,UAAU,iBAAiB,CAAC,MAAM;YACpC;YAEA,MAAM,WACJ,QAAQ,IAAI,KAAK,aAAa,sBAAsB;YAEtD,mBAAmB,IAAI,CAAC;gBACtB;gBACA;gBACA,QAAQ,QAAQ,MAAM;gBACtB,MAAM,QAAQ,IAAI;gBAClB,MAAM,QAAQ,IAAI;gBAClB,WAAW,QAAQ,SAAS;YAC9B;QACF;QAEA,OAAO;IACT;IAEA;;;;;GAKC,GACD,OAAO,eAAe,QAAQ,EAAE,KAAK,EAAE;QACrC,MAAM,OAAO,KAAK,KAAK,CAAC,SAAS,MAAM,GAAG;QAC1C,MAAM,WAAW,EAAE;QAEnB,IAAK,IAAI,IAAI,GAAG,IAAI,SAAS,IAAI,OAAO,SAAS,MAAM,EAAE,IAAK;YAC5D,SAAS,IAAI,CAAC,QAAQ,CAAC,IAAI,KAAK;QAClC;QAEA,OAAO;IACT;AACF"}},
    {"offset": {"line": 1340, "column": 0}, "map": {"version":3,"sources":["file:///C:/projetos/math/lib/services/HTMLFormatterService.js"],"sourcesContent":["/**\r\n * Service for formatting exercises to HTML\r\n * Adapts existing templates for web rendering\r\n */\r\n\r\nimport { getRandomName } from '../constants/namePool.js';\r\n\r\nexport class HTMLFormatterService {\r\n  /**\r\n   * Formats grid problems to HTML\r\n   * @param {Array} problems - Problem list\r\n   * @param {object} stats - Statistics\r\n   * @param {object} options - Formatting options\r\n   * @returns {string} - Formatted HTML\r\n   */\r\n  static formatGrid(problems, stats, options = {}) {\r\n    const { includeAnswerKey = false, studentName = getRandomName() } = options;\r\n\r\n    const title = includeAnswerKey\r\n      ? `Gabarito - ${stats.totalProblems || stats.total || problems.length} Exerc√≠cios de Matem√°tica`\r\n      : `${stats.totalProblems || stats.total || problems.length} Exerc√≠cios de Matem√°tica para ${studentName}`;\r\n\r\n    const problemsHtml = problems\r\n      .map((problem, index) => {\r\n        const display = problem.operation;\r\n        const answer = includeAnswerKey ? ` = <strong>${problem.answer}</strong>` : ' = _____';\r\n        \r\n        return `<div class=\"problem-item\">\r\n          <span class=\"problem-number\">${index + 1})</span>\r\n          <span class=\"problem-expression\">${display}${answer}</span>\r\n        </div>`;\r\n      })\r\n      .join('\\n');\r\n\r\n    return `\r\n<!DOCTYPE html>\r\n<html lang=\"pt-BR\">\r\n<head>\r\n  <meta charset=\"UTF-8\">\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n  <title>${title}</title>\r\n  <style>\r\n    * {\r\n      margin: 0;\r\n      padding: 0;\r\n      box-sizing: border-box;\r\n    }\r\n    \r\n    body {\r\n      font-family: 'Comic Sans MS', 'Comic Neue', cursive, sans-serif;\r\n      padding: 40px;\r\n      max-width: 900px;\r\n      margin: 0 auto;\r\n      background: white;\r\n    }\r\n    \r\n    .header {\r\n      text-align: center;\r\n      margin-bottom: 30px;\r\n      border-bottom: 3px solid #ff6b9d;\r\n      padding-bottom: 20px;\r\n    }\r\n    \r\n    h1 {\r\n      color: #ff6b9d;\r\n      font-size: 28px;\r\n      margin-bottom: 10px;\r\n    }\r\n    \r\n    .stats {\r\n      color: #666;\r\n      font-size: 14px;\r\n      margin-top: 10px;\r\n    }\r\n    \r\n    .stats-badge {\r\n      display: inline-block;\r\n      background: #f0f0f0;\r\n      padding: 4px 12px;\r\n      border-radius: 12px;\r\n      margin: 0 5px;\r\n    }\r\n    \r\n    .problems-grid {\r\n      display: grid;\r\n      grid-template-columns: repeat(2, 1fr);\r\n      gap: 15px 30px;\r\n      margin-top: 30px;\r\n    }\r\n    \r\n    .problem-item {\r\n      display: flex;\r\n      align-items: center;\r\n      font-size: 18px;\r\n      padding: 8px;\r\n      border-bottom: 1px solid #eee;\r\n    }\r\n    \r\n    .problem-number {\r\n      color: #c084fc;\r\n      font-weight: bold;\r\n      margin-right: 10px;\r\n      min-width: 35px;\r\n    }\r\n    \r\n    .problem-expression {\r\n      font-size: 20px;\r\n      font-family: 'Courier New', monospace;\r\n    }\r\n    \r\n    .problem-expression strong {\r\n      color: #36d399;\r\n    }\r\n    \r\n    .footer {\r\n      margin-top: 40px;\r\n      text-align: center;\r\n      color: #999;\r\n      font-size: 12px;\r\n      border-top: 1px solid #eee;\r\n      padding-top: 20px;\r\n    }\r\n    \r\n    @media print {\r\n      body {\r\n        padding: 20px;\r\n      }\r\n      \r\n      .no-print {\r\n        display: none !important;\r\n      }\r\n      \r\n      .problems-grid {\r\n        break-inside: avoid;\r\n      }\r\n    }\r\n    \r\n    @media screen {\r\n      .print-actions {\r\n        position: fixed;\r\n        top: 20px;\r\n        right: 20px;\r\n        display: flex;\r\n        gap: 10px;\r\n      }\r\n      \r\n      .btn {\r\n        padding: 12px 24px;\r\n        border: none;\r\n        border-radius: 8px;\r\n        font-size: 14px;\r\n        font-weight: bold;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n      }\r\n      \r\n      .btn-print {\r\n        background: #ff6b9d;\r\n        color: white;\r\n      }\r\n      \r\n      .btn-print:hover {\r\n        background: #ff5085;\r\n        transform: translateY(-2px);\r\n      }\r\n      \r\n      .btn-close {\r\n        background: #e5e5e5;\r\n        color: #333;\r\n      }\r\n      \r\n      .btn-close:hover {\r\n        background: #d0d0d0;\r\n      }\r\n    }\r\n  </style>\r\n</head>\r\n<body>\r\n  <div class=\"print-actions no-print\">\r\n    <button class=\"btn btn-print\" onclick=\"window.print()\">üñ®Ô∏è Imprimir</button>\r\n    <button class=\"btn btn-close\" onclick=\"window.close()\">‚úñÔ∏è Fechar</button>\r\n  </div>\r\n\r\n  <div class=\"header\">\r\n    <h1>${title}</h1>\r\n    <div class=\"stats\">\r\n      <span class=\"stats-badge\">Total: ${stats.totalProblems || problems.length}</span>\r\n      <span class=\"stats-badge\">Adi√ß√£o: ${stats.additions || 0}</span>\r\n      <span class=\"stats-badge\">Subtra√ß√£o: ${stats.subtractions || 0}</span>\r\n      ${stats.multiplications ? `<span class=\"stats-badge\">Multiplica√ß√£o: ${stats.multiplications}</span>` : ''}\r\n      ${stats.divisions ? `<span class=\"stats-badge\">Divis√£o: ${stats.divisions}</span>` : ''}\r\n      <span class=\"stats-badge\">Dificuldade: ${this.getDifficultyLabel(stats.difficulty)}</span>\r\n    </div>\r\n    ${!includeAnswerKey ? `<div style=\"margin-top: 15px; font-size: 14px;\">Nome: ___________________________ Data: ___/___/___</div>` : ''}\r\n  </div>\r\n\r\n  <div class=\"problems-grid\">\r\n    ${problemsHtml}\r\n  </div>\r\n\r\n  ${!includeAnswerKey ? `\r\n  <div class=\"score-section\" style=\"margin-top: 40px; padding: 20px; border: 2px solid #ff6b9d; border-radius: 12px; text-align: center;\">\r\n    <h2 style=\"color: #ff6b9d; margin-bottom: 15px; font-size: 22px;\">üìä Meu Resultado</h2>\r\n    <div style=\"display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;\">\r\n      <div style=\"background: #f0f0f0; padding: 15px 30px; border-radius: 8px;\">\r\n        <div style=\"font-size: 14px; color: #666;\">Total de Quest√µes</div>\r\n        <div style=\"font-size: 32px; font-weight: bold; color: #c084fc;\">${stats.totalProblems || problems.length}</div>\r\n      </div>\r\n      <div style=\"background: #f0fdf4; padding: 15px 30px; border-radius: 8px;\">\r\n        <div style=\"font-size: 14px; color: #666;\">Acertos</div>\r\n        <div style=\"font-size: 32px; font-weight: bold; color: #36d399;\">____</div>\r\n      </div>\r\n      <div style=\"background: #fff7ed; padding: 15px 30px; border-radius: 8px;\">\r\n        <div style=\"font-size: 14px; color: #666;\">Minha Nota</div>\r\n        <div style=\"font-size: 32px; font-weight: bold; color: #fb923c;\">____</div>\r\n      </div>\r\n    </div>\r\n    <div style=\"margin-top: 20px; color: #666; font-size: 14px;\">\r\n      üåü Parab√©ns pelo esfor√ßo! Continue praticando!\r\n    </div>\r\n  </div>\r\n  ` : ''}\r\n\r\n  <div class=\"footer\">\r\n    <p>Material gerado com ‚ù§Ô∏è para ${studentName} ‚Ä¢ ${new Date().toLocaleDateString('pt-BR')}</p>\r\n  </div>\r\n</body>\r\n</html>\r\n`;\r\n  }\r\n\r\n  /**\r\n   * Formats contextualized problems to HTML\r\n   * @param {Array} contextualProblems - List of contextualized problems\r\n   * @param {object} stats - Statistics\r\n   * @param {object} options - Formatting options\r\n   * @returns {string} - Formatted HTML\r\n   */\r\n  static formatContextual(contextualProblems, stats, options = {}) {\r\n    const { includeAnswerKey = false, studentName = getRandomName() } = options;\r\n\r\n    const title = includeAnswerKey\r\n      ? 'Gabarito - Problemas Contextualizados'\r\n      : `Problemas Contextualizados para ${studentName}`;\r\n\r\n    const problemsHtml = contextualProblems\r\n      .map((problem, index) => {\r\n        const answerHtml = includeAnswerKey\r\n          ? `<div class=\"answer\">\r\n              <strong>Resposta:</strong> ${problem.answer}\r\n              <span class=\"operation-hint\">(${problem.num1} ${problem.operation} ${problem.num2})</span>\r\n             </div>`\r\n          : `<div class=\"answer-space\">\r\n              <strong>Resposta:</strong> _______________\r\n             </div>`;\r\n\r\n        return `\r\n        <div class=\"problem-card\">\r\n          <div class=\"problem-header\">\r\n            <span class=\"problem-number\">Problema ${index + 1}</span>\r\n          </div>\r\n          <div class=\"problem-context\">${problem.context}</div>\r\n          <div class=\"problem-question\">${problem.question}</div>\r\n          ${answerHtml}\r\n        </div>\r\n        `;\r\n      })\r\n      .join('\\n');\r\n\r\n    return `\r\n<!DOCTYPE html>\r\n<html lang=\"pt-BR\">\r\n<head>\r\n  <meta charset=\"UTF-8\">\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n  <title>${title}</title>\r\n  <style>\r\n    * {\r\n      margin: 0;\r\n      padding: 0;\r\n      box-sizing: border-box;\r\n    }\r\n    \r\n    body {\r\n      font-family: 'Comic Sans MS', 'Comic Neue', cursive, sans-serif;\r\n      padding: 40px;\r\n      max-width: 800px;\r\n      margin: 0 auto;\r\n      background: #fafafa;\r\n      line-height: 1.6;\r\n    }\r\n    \r\n    .header {\r\n      text-align: center;\r\n      margin-bottom: 30px;\r\n      background: white;\r\n      padding: 30px;\r\n      border-radius: 12px;\r\n      box-shadow: 0 2px 8px rgba(0,0,0,0.1);\r\n    }\r\n    \r\n    h1 {\r\n      color: #c084fc;\r\n      font-size: 28px;\r\n      margin-bottom: 10px;\r\n    }\r\n    \r\n    .problem-card {\r\n      background: white;\r\n      border-radius: 12px;\r\n      padding: 25px;\r\n      margin-bottom: 25px;\r\n      box-shadow: 0 2px 8px rgba(0,0,0,0.1);\r\n      border-left: 4px solid #ff6b9d;\r\n    }\r\n    \r\n    .problem-header {\r\n      margin-bottom: 15px;\r\n    }\r\n    \r\n    .problem-number {\r\n      background: #ff6b9d;\r\n      color: white;\r\n      padding: 6px 16px;\r\n      border-radius: 20px;\r\n      font-weight: bold;\r\n      font-size: 14px;\r\n    }\r\n    \r\n    .problem-context {\r\n      font-size: 16px;\r\n      color: #333;\r\n      margin-bottom: 12px;\r\n      line-height: 1.8;\r\n    }\r\n    \r\n    .problem-question {\r\n      font-weight: bold;\r\n      color: #fb923c;\r\n      font-size: 17px;\r\n      margin-bottom: 15px;\r\n    }\r\n    \r\n    .answer {\r\n      background: #f0fdf4;\r\n      border: 2px solid #36d399;\r\n      border-radius: 8px;\r\n      padding: 12px;\r\n      margin-top: 15px;\r\n      font-size: 16px;\r\n      color: #166534;\r\n    }\r\n    \r\n    .answer strong {\r\n      color: #36d399;\r\n    }\r\n    \r\n    .operation-hint {\r\n      color: #666;\r\n      font-size: 14px;\r\n      margin-left: 10px;\r\n    }\r\n    \r\n    .answer-space {\r\n      border: 2px dashed #ccc;\r\n      border-radius: 8px;\r\n      padding: 20px;\r\n      margin-top: 15px;\r\n      background: #fafafa;\r\n    }\r\n    \r\n    .footer {\r\n      margin-top: 40px;\r\n      text-align: center;\r\n      color: #999;\r\n      font-size: 12px;\r\n    }\r\n    \r\n    @media print {\r\n      body {\r\n        padding: 20px;\r\n        background: white;\r\n      }\r\n      \r\n      .no-print {\r\n        display: none !important;\r\n      }\r\n      \r\n      .problem-card {\r\n        break-inside: avoid;\r\n        box-shadow: none;\r\n        border: 1px solid #ddd;\r\n      }\r\n    }\r\n    \r\n    @media screen {\r\n      .print-actions {\r\n        position: fixed;\r\n        top: 20px;\r\n        right: 20px;\r\n        display: flex;\r\n        gap: 10px;\r\n        z-index: 1000;\r\n      }\r\n      \r\n      .btn {\r\n        padding: 12px 24px;\r\n        border: none;\r\n        border-radius: 8px;\r\n        font-size: 14px;\r\n        font-weight: bold;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n        box-shadow: 0 2px 4px rgba(0,0,0,0.2);\r\n      }\r\n      \r\n      .btn-print {\r\n        background: #c084fc;\r\n        color: white;\r\n      }\r\n      \r\n      .btn-print:hover {\r\n        background: #a855f7;\r\n        transform: translateY(-2px);\r\n      }\r\n      \r\n      .btn-close {\r\n        background: #e5e5e5;\r\n        color: #333;\r\n      }\r\n      \r\n      .btn-close:hover {\r\n        background: #d0d0d0;\r\n      }\r\n    }\r\n  </style>\r\n</head>\r\n<body>\r\n  <div class=\"print-actions no-print\">\r\n    <button class=\"btn btn-print\" onclick=\"window.print()\">üñ®Ô∏è Imprimir</button>\r\n    <button class=\"btn btn-close\" onclick=\"window.close()\">‚úñÔ∏è Fechar</button>\r\n  </div>\r\n\r\n  <div class=\"header\">\r\n    <h1>${title}</h1>\r\n    ${!includeAnswerKey ? `<div style=\"margin-top: 15px; font-size: 14px;\">Nome: ___________________________ Data: ___/___/___</div>` : ''}\r\n  </div>\r\n\r\n  ${problemsHtml}\r\n\r\n  ${!includeAnswerKey ? `\r\n  <div class=\"score-section\" style=\"margin-top: 40px; padding: 20px; border: 2px solid #c084fc; border-radius: 12px; text-align: center;\">\r\n    <h2 style=\"color: #c084fc; margin-bottom: 15px; font-size: 22px;\">üìä Meu Resultado</h2>\r\n    <div style=\"display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;\">\r\n      <div style=\"background: #f0f0f0; padding: 15px 30px; border-radius: 8px;\">\r\n        <div style=\"font-size: 14px; color: #666;\">Total de Quest√µes</div>\r\n        <div style=\"font-size: 32px; font-weight: bold; color: #c084fc;\">${contextualProblems.length}</div>\r\n      </div>\r\n      <div style=\"background: #f0fdf4; padding: 15px 30px; border-radius: 8px;\">\r\n        <div style=\"font-size: 14px; color: #666;\">Acertos</div>\r\n        <div style=\"font-size: 32px; font-weight: bold; color: #36d399;\">____</div>\r\n      </div>\r\n      <div style=\"background: #fff7ed; padding: 15px 30px; border-radius: 8px;\">\r\n        <div style=\"font-size: 14px; color: #666;\">Minha Nota</div>\r\n        <div style=\"font-size: 32px; font-weight: bold; color: #fb923c;\">____</div>\r\n      </div>\r\n    </div>\r\n    <div style=\"margin-top: 20px; color: #666; font-size: 14px;\">\r\n      üåü Parab√©ns pelo esfor√ßo! Continue praticando!\r\n    </div>\r\n  </div>\r\n  ` : ''}\r\n\r\n  <div class=\"footer\">\r\n    <p>Material gerado com ‚ù§Ô∏è para ${studentName} ‚Ä¢ ${new Date().toLocaleDateString('pt-BR')}</p>\r\n  </div>\r\n</body>\r\n</html>\r\n`;\r\n  }\r\n\r\n  /**\r\n   * Returns the difficulty label\r\n   */\r\n  static getDifficultyLabel(difficulty) {\r\n    const labels = {\r\n      easy: 'F√°cil',\r\n      medium: 'M√©dio',\r\n      hard: 'Dif√≠cil',\r\n    };\r\n    return labels[difficulty] || 'M√©dio';\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1816, "column": 0}, "map": {"version":3,"sources":["file:///C:/projetos/math/lib/cache/exerciseCache.js"],"sourcesContent":["/**\r\n * Cache em mem√≥ria para exerc√≠cios gerados\r\n * Usa Map para armazenar temporariamente os exerc√≠cios\r\n */\r\n\r\nclass ExerciseCache {\r\n  constructor() {\r\n    this.cache = new Map();\r\n  }\r\n\r\n  /**\r\n   * Salva um exerc√≠cio no cache\r\n   * @param {string} id - ID √∫nico do exerc√≠cio\r\n   * @param {object} data - Dados do exerc√≠cio\r\n   */\r\n  set(id, data) {\r\n    this.cache.set(id, {\r\n      data,\r\n      timestamp: Date.now(),\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Busca um exerc√≠cio do cache\r\n   * @param {string} id - ID √∫nico do exerc√≠cio\r\n   * @returns {object|null} - Dados do exerc√≠cio ou null\r\n   */\r\n  get(id) {\r\n    const entry = this.cache.get(id);\r\n    if (!entry) {\r\n      return null;\r\n    }\r\n\r\n    const ONE_HOUR = 60 * 60 * 1000;\r\n    if (Date.now() - entry.timestamp > ONE_HOUR) {\r\n      this.cache.delete(id);\r\n      return null;\r\n    }\r\n\r\n    return entry.data;\r\n  }\r\n\r\n  /**\r\n   * Remove um exerc√≠cio do cache\r\n   * @param {string} id - ID √∫nico do exerc√≠cio\r\n   */\r\n  delete(id) {\r\n    this.cache.delete(id);\r\n  }\r\n\r\n  /**\r\n   * Limpa todos os exerc√≠cios expirados\r\n   */\r\n  cleanup() {\r\n    const ONE_HOUR = 60 * 60 * 1000;\r\n    const now = Date.now();\r\n\r\n    for (const [id, entry] of this.cache.entries()) {\r\n      if (now - entry.timestamp > ONE_HOUR) {\r\n        this.cache.delete(id);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Retorna estat√≠sticas do cache\r\n   */\r\n  getStats() {\r\n    return {\r\n      size: this.cache.size,\r\n      keys: Array.from(this.cache.keys()),\r\n    };\r\n  }\r\n}\r\n\r\n// Singleton usando global para persistir durante hot reload\r\nconst globalForCache = global;\r\n\r\nexport function getExerciseCache() {\r\n  if (!globalForCache.__exerciseCache) {\r\n    globalForCache.__exerciseCache = new ExerciseCache();\r\n    \r\n    // Cleanup autom√°tico a cada 30 minutos\r\n    setInterval(() => {\r\n      globalForCache.__exerciseCache.cleanup();\r\n    }, 30 * 60 * 1000);\r\n  }\r\n  return globalForCache.__exerciseCache;\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;;CAGC,GAED,MAAM;IACJ,aAAc;QACZ,IAAI,CAAC,KAAK,GAAG,IAAI;IACnB;IAEA;;;;GAIC,GACD,IAAI,EAAE,EAAE,IAAI,EAAE;QACZ,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI;YACjB;YACA,WAAW,KAAK,GAAG;QACrB;IACF;IAEA;;;;GAIC,GACD,IAAI,EAAE,EAAE;QACN,MAAM,QAAQ,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC;QAC7B,IAAI,CAAC,OAAO;YACV,OAAO;QACT;QAEA,MAAM,WAAW,KAAK,KAAK;QAC3B,IAAI,KAAK,GAAG,KAAK,MAAM,SAAS,GAAG,UAAU;YAC3C,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC;YAClB,OAAO;QACT;QAEA,OAAO,MAAM,IAAI;IACnB;IAEA;;;GAGC,GACD,OAAO,EAAE,EAAE;QACT,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC;IACpB;IAEA;;GAEC,GACD,UAAU;QACR,MAAM,WAAW,KAAK,KAAK;QAC3B,MAAM,MAAM,KAAK,GAAG;QAEpB,KAAK,MAAM,CAAC,IAAI,MAAM,IAAI,IAAI,CAAC,KAAK,CAAC,OAAO,GAAI;YAC9C,IAAI,MAAM,MAAM,SAAS,GAAG,UAAU;gBACpC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC;YACpB;QACF;IACF;IAEA;;GAEC,GACD,WAAW;QACT,OAAO;YACL,MAAM,IAAI,CAAC,KAAK,CAAC,IAAI;YACrB,MAAM,MAAM,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI;QAClC;IACF;AACF;AAEA,4DAA4D;AAC5D,MAAM;AAEC,SAAS;IACd,IAAI,CAAC,eAAe,eAAe,EAAE;QACnC,eAAe,eAAe,GAAG,IAAI;QAErC,uCAAuC;QACvC,YAAY;YACV,eAAe,eAAe,CAAC,OAAO;QACxC,GAAG,KAAK,KAAK;IACf;IACA,OAAO,eAAe,eAAe;AACvC"}},
    {"offset": {"line": 1895, "column": 0}, "map": {"version":3,"sources":["file:///C:/projetos/math/lib/constants/namePool.ts"],"sourcesContent":["/**\r\n * Multilingual name pool for math exercises\r\n * Names selected to work well in both Portuguese and English\r\n */\r\n\r\nexport interface NameInfo {\r\n  name: string;\r\n  gender: 'feminine' | 'masculine';\r\n}\r\n\r\nexport const NAME_POOL: NameInfo[] = [\r\n  // Feminine names\r\n  { name: 'Luna', gender: 'feminine' },\r\n  { name: 'Maya', gender: 'feminine' },\r\n  { name: 'Nina', gender: 'feminine' },\r\n  { name: 'Mia', gender: 'feminine' },\r\n  { name: 'Jade', gender: 'feminine' },\r\n  { name: 'Lara', gender: 'feminine' },\r\n  { name: 'Sofia', gender: 'feminine' },\r\n  { name: 'Ana', gender: 'feminine' },\r\n  { name: 'Emma', gender: 'feminine' },\r\n  \r\n  // Masculine names\r\n  { name: 'Leo', gender: 'masculine' },\r\n  { name: 'Noah', gender: 'masculine' },\r\n  { name: 'Davi', gender: 'masculine' },\r\n  { name: 'Kai', gender: 'masculine' },\r\n  { name: 'Lucas', gender: 'masculine' },\r\n  { name: 'Theo', gender: 'masculine' },\r\n  { name: 'Samuel', gender: 'masculine' },\r\n  { name: 'Enzo', gender: 'masculine' },\r\n  { name: 'Miguel', gender: 'masculine' },\r\n];\r\n\r\n/**\r\n * Gets a random name from the pool\r\n * @param gender - Filter by gender (optional)\r\n * @param seed - Seed for deterministic randomization (optional)\r\n * @returns Selected name\r\n */\r\nexport function getRandomName(gender?: 'feminine' | 'masculine', seed?: number): string {\r\n  const filteredPool = gender \r\n    ? NAME_POOL.filter(n => n.gender === gender)\r\n    : NAME_POOL;\r\n  \r\n  if (seed !== undefined) {\r\n    // Deterministic randomization using seed\r\n    const index = seed % filteredPool.length;\r\n    return filteredPool[index].name;\r\n  }\r\n  \r\n  // True randomization\r\n  const randomIndex = Math.floor(Math.random() * filteredPool.length);\r\n  return filteredPool[randomIndex].name;\r\n}\r\n\r\n/**\r\n * Gets multiple unique names\r\n * @param count - Number of names to return\r\n * @param gender - Filter by gender (optional)\r\n * @returns Array of unique names\r\n */\r\nexport function getRandomNames(count: number, gender?: 'feminine' | 'masculine'): string[] {\r\n  const filteredPool = gender \r\n    ? NAME_POOL.filter(n => n.gender === gender)\r\n    : NAME_POOL;\r\n  \r\n  const shuffled = [...filteredPool].sort(() => Math.random() - 0.5);\r\n  return shuffled.slice(0, Math.min(count, shuffled.length)).map(n => n.name);\r\n}\r\n\r\n/**\r\n * Gets a consistent name based on an ID/hash\r\n * Useful for maintaining the same name across an exercise set\r\n * @param id - Unique identifier (string or number)\r\n * @param gender - Filter by gender (optional)\r\n * @returns Consistent name for the provided ID\r\n */\r\nexport function getConsistentName(id: string | number, gender?: 'feminine' | 'masculine'): string {\r\n  const filteredPool = gender \r\n    ? NAME_POOL.filter(n => n.gender === gender)\r\n    : NAME_POOL;\r\n  \r\n  // Generate simple hash from ID\r\n  const hash = typeof id === 'string' \r\n    ? id.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0)\r\n    : id;\r\n  \r\n  const index = hash % filteredPool.length;\r\n  return filteredPool[index].name;\r\n}\r\n\r\n/**\r\n * Gets all names as comma-separated string\r\n * Useful for AI prompts\r\n */\r\nexport function getAllNamesString(): string {\r\n  return NAME_POOL.map(n => n.name).join(', ');\r\n}\r\n\r\n/**\r\n * Checks if text contains any name from the pool\r\n * @param text - Text to check\r\n * @returns true if contains any name from the pool\r\n */\r\nexport function containsAnyName(text: string): boolean {\r\n  const lowerText = text.toLowerCase();\r\n  return NAME_POOL.some(n => lowerText.includes(n.name.toLowerCase()));\r\n}\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;;;;;;;;;AAOM,MAAM,YAAwB;IACnC,iBAAiB;IACjB;QAAE,MAAM;QAAQ,QAAQ;IAAW;IACnC;QAAE,MAAM;QAAQ,QAAQ;IAAW;IACnC;QAAE,MAAM;QAAQ,QAAQ;IAAW;IACnC;QAAE,MAAM;QAAO,QAAQ;IAAW;IAClC;QAAE,MAAM;QAAQ,QAAQ;IAAW;IACnC;QAAE,MAAM;QAAQ,QAAQ;IAAW;IACnC;QAAE,MAAM;QAAS,QAAQ;IAAW;IACpC;QAAE,MAAM;QAAO,QAAQ;IAAW;IAClC;QAAE,MAAM;QAAQ,QAAQ;IAAW;IAEnC,kBAAkB;IAClB;QAAE,MAAM;QAAO,QAAQ;IAAY;IACnC;QAAE,MAAM;QAAQ,QAAQ;IAAY;IACpC;QAAE,MAAM;QAAQ,QAAQ;IAAY;IACpC;QAAE,MAAM;QAAO,QAAQ;IAAY;IACnC;QAAE,MAAM;QAAS,QAAQ;IAAY;IACrC;QAAE,MAAM;QAAQ,QAAQ;IAAY;IACpC;QAAE,MAAM;QAAU,QAAQ;IAAY;IACtC;QAAE,MAAM;QAAQ,QAAQ;IAAY;IACpC;QAAE,MAAM;QAAU,QAAQ;IAAY;CACvC;AAQM,SAAS,cAAc,MAAiC,EAAE,IAAa;IAC5E,MAAM,eAAe,SACjB,UAAU,MAAM,CAAC,CAAA,IAAK,EAAE,MAAM,KAAK,UACnC;IAEJ,IAAI,SAAS,WAAW;QACtB,yCAAyC;QACzC,MAAM,QAAQ,OAAO,aAAa,MAAM;QACxC,OAAO,YAAY,CAAC,MAAM,CAAC,IAAI;IACjC;IAEA,qBAAqB;IACrB,MAAM,cAAc,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,aAAa,MAAM;IAClE,OAAO,YAAY,CAAC,YAAY,CAAC,IAAI;AACvC;AAQO,SAAS,eAAe,KAAa,EAAE,MAAiC;IAC7E,MAAM,eAAe,SACjB,UAAU,MAAM,CAAC,CAAA,IAAK,EAAE,MAAM,KAAK,UACnC;IAEJ,MAAM,WAAW;WAAI;KAAa,CAAC,IAAI,CAAC,IAAM,KAAK,MAAM,KAAK;IAC9D,OAAO,SAAS,KAAK,CAAC,GAAG,KAAK,GAAG,CAAC,OAAO,SAAS,MAAM,GAAG,GAAG,CAAC,CAAA,IAAK,EAAE,IAAI;AAC5E;AASO,SAAS,kBAAkB,EAAmB,EAAE,MAAiC;IACtF,MAAM,eAAe,SACjB,UAAU,MAAM,CAAC,CAAA,IAAK,EAAE,MAAM,KAAK,UACnC;IAEJ,+BAA+B;IAC/B,MAAM,OAAO,OAAO,OAAO,WACvB,GAAG,KAAK,CAAC,IAAI,MAAM,CAAC,CAAC,KAAK,OAAS,MAAM,KAAK,UAAU,CAAC,IAAI,KAC7D;IAEJ,MAAM,QAAQ,OAAO,aAAa,MAAM;IACxC,OAAO,YAAY,CAAC,MAAM,CAAC,IAAI;AACjC;AAMO,SAAS;IACd,OAAO,UAAU,GAAG,CAAC,CAAA,IAAK,EAAE,IAAI,EAAE,IAAI,CAAC;AACzC;AAOO,SAAS,gBAAgB,IAAY;IAC1C,MAAM,YAAY,KAAK,WAAW;IAClC,OAAO,UAAU,IAAI,CAAC,CAAA,IAAK,UAAU,QAAQ,CAAC,EAAE,IAAI,CAAC,WAAW;AAClE"}},
    {"offset": {"line": 2024, "column": 0}, "map": {"version":3,"sources":["file:///C:/projetos/math/app/actions/generateExercises.ts"],"sourcesContent":["'use server';\r\n\r\nimport { z } from 'zod';\r\nimport { nanoid } from 'nanoid';\r\nimport { MathGeneratorService } from '@/lib/services/MathGeneratorService';\r\nimport { AIEnhancerService } from '@/lib/services/AIEnhancerService';\r\nimport { HTMLFormatterService } from '@/lib/services/HTMLFormatterService';\r\nimport { getExerciseCache } from '@/lib/cache/exerciseCache';\r\nimport { getRandomName } from '@/lib/constants/namePool';\r\nimport type { GenerateProblemsResult } from '@/lib/types/math';\r\n\r\n// Validation schema\r\nconst GenerateExercisesSchema = z.object({\r\n  totalProblems: z.number().int().min(1).max(200).default(50),\r\n  difficulty: z.enum(['easy', 'medium', 'hard']).default('medium'),\r\n  useAI: z.boolean().default(false),\r\n  includeAnswerKey: z.boolean().default(false),\r\n  studentName: z.string().optional(),\r\n  format: z.enum(['grid', 'contextual', 'both']).default('grid'),\r\n  digitConfigs: z.array(z.object({\r\n    digits: z.number().int().min(1).max(5),\r\n    questions: z.number().int().min(0).max(100),\r\n    operation: z.enum(['addition', 'subtraction', 'multiplication', 'division', 'mixed']),\r\n    divisorMin: z.number().int().min(1).max(100).optional(),\r\n    divisorMax: z.number().int().min(1).max(100).optional(),\r\n  })).optional(),\r\n});\r\n\r\nexport type GenerateExercisesInput = z.infer<typeof GenerateExercisesSchema>;\r\n\r\nexport interface GenerateExercisesResult {\r\n  success: boolean;\r\n  exerciseId?: string;\r\n  gridExerciseId?: string;\r\n  contextualExerciseId?: string;\r\n  error?: string;\r\n}\r\n\r\n/**\r\n * Server Action to generate math exercises\r\n */\r\nexport async function generateExercises(\r\n  input: GenerateExercisesInput\r\n): Promise<GenerateExercisesResult> {\r\n  try {\r\n    // Validate input\r\n    const validatedInput = GenerateExercisesSchema.parse(input);\r\n\r\n    // Use random name from pool if not provided\r\n    const studentName = validatedInput.studentName || getRandomName();\r\n\r\n    // Validate options and generate problems\r\n    const options = MathGeneratorService.validateOptions({\r\n      ...validatedInput,\r\n      digitConfigs: validatedInput.digitConfigs,\r\n    });\r\n    const { problems, stats } = MathGeneratorService.generateProblems(options) as GenerateProblemsResult;\r\n\r\n    const cache = getExerciseCache();\r\n    const result: GenerateExercisesResult = { success: true };\r\n\r\n    // Gerar exerc√≠cio em grade\r\n    if (validatedInput.format === 'grid' || validatedInput.format === 'both') {\r\n      const gridHtml = HTMLFormatterService.formatGrid(problems, stats, {\r\n        includeAnswerKey: validatedInput.includeAnswerKey,\r\n        studentName,\r\n      });\r\n\r\n      const gridId = nanoid(10);\r\n      cache.set(gridId, {\r\n        type: 'grid',\r\n        html: gridHtml,\r\n        stats,\r\n        options: validatedInput,\r\n      });\r\n\r\n      result.gridExerciseId = gridId;\r\n      if (validatedInput.format === 'grid') {\r\n        result.exerciseId = gridId;\r\n      }\r\n    }\r\n\r\n    // Generate contextualized problems (with AI if enabled)\r\n    if (\r\n      validatedInput.format === 'contextual' ||\r\n      validatedInput.format === 'both'\r\n    ) {\r\n      if (validatedInput.useAI) {\r\n        try {\r\n          const contextualProblems =\r\n            await AIEnhancerService.generateContextualProblems(problems, 10);\r\n\r\n          const contextualHtml = HTMLFormatterService.formatContextual(\r\n            contextualProblems,\r\n            stats,\r\n            {\r\n              includeAnswerKey: validatedInput.includeAnswerKey,\r\n              studentName,\r\n            }\r\n          );\r\n\r\n          const contextualId = nanoid(10);\r\n          cache.set(contextualId, {\r\n            type: 'contextual',\r\n            html: contextualHtml,\r\n            stats,\r\n            options: validatedInput,\r\n          });\r\n\r\n          result.contextualExerciseId = contextualId;\r\n          if (validatedInput.format === 'contextual') {\r\n            result.exerciseId = contextualId;\r\n          }\r\n        } catch (aiError: any) {\r\n          console.error('Error generating contexts with AI:', aiError);\r\n          return {\r\n            success: false,\r\n            error: `Error generating contexts with AI: ${aiError.message}`,\r\n          };\r\n        }\r\n      } else {\r\n        // Use simple templates without AI\r\n        const simpleContextual = AIEnhancerService.selectProblems(\r\n          problems,\r\n          10\r\n        ).map((p) => ({\r\n          context: `${studentName} tem ${p.num1} itens e ${p.type === 'addition' ? 'ganhou' : 'deu'} ${p.num2} itens.`,\r\n          question:\r\n            p.type === 'addition' ? 'Quantos no total?' : 'Quantos restaram?',\r\n          answer: p.answer,\r\n          num1: p.num1,\r\n          num2: p.num2,\r\n          operation: p.operation,\r\n        }));\r\n\r\n        const contextualHtml = HTMLFormatterService.formatContextual(\r\n          simpleContextual,\r\n          stats,\r\n          {\r\n            includeAnswerKey: validatedInput.includeAnswerKey,\r\n            studentName,\r\n          }\r\n        );\r\n\r\n        const contextualId = nanoid(10);\r\n        cache.set(contextualId, {\r\n          type: 'contextual',\r\n          html: contextualHtml,\r\n          stats,\r\n          options: validatedInput,\r\n        });\r\n\r\n        result.contextualExerciseId = contextualId;\r\n        if (validatedInput.format === 'contextual') {\r\n          result.exerciseId = contextualId;\r\n        }\r\n      }\r\n    }\r\n\r\n    return result;\r\n  } catch (error: any) {\r\n    console.error('Error generating exercises:', error);\r\n    return {\r\n      success: false,\r\n      error: error.message || 'Unknown error generating exercises',\r\n    };\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;AAGA,oBAAoB;AACpB,MAAM,0BAA0B,kLAAC,CAAC,MAAM,CAAC;IACvC,eAAe,kLAAC,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC,KAAK,OAAO,CAAC;IACxD,YAAY,kLAAC,CAAC,IAAI,CAAC;QAAC;QAAQ;QAAU;KAAO,EAAE,OAAO,CAAC;IACvD,OAAO,kLAAC,CAAC,OAAO,GAAG,OAAO,CAAC;IAC3B,kBAAkB,kLAAC,CAAC,OAAO,GAAG,OAAO,CAAC;IACtC,aAAa,kLAAC,CAAC,MAAM,GAAG,QAAQ;IAChC,QAAQ,kLAAC,CAAC,IAAI,CAAC;QAAC;QAAQ;QAAc;KAAO,EAAE,OAAO,CAAC;IACvD,cAAc,kLAAC,CAAC,KAAK,CAAC,kLAAC,CAAC,MAAM,CAAC;QAC7B,QAAQ,kLAAC,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC;QACpC,WAAW,kLAAC,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC;QACvC,WAAW,kLAAC,CAAC,IAAI,CAAC;YAAC;YAAY;YAAe;YAAkB;YAAY;SAAQ;QACpF,YAAY,kLAAC,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC,KAAK,QAAQ;QACrD,YAAY,kLAAC,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC,KAAK,QAAQ;IACvD,IAAI,QAAQ;AACd;AAeO,eAAe,kBACpB,KAA6B;IAE7B,IAAI;QACF,iBAAiB;QACjB,MAAM,iBAAiB,wBAAwB,KAAK,CAAC;QAErD,4CAA4C;QAC5C,MAAM,cAAc,eAAe,WAAW,IAAI,IAAA,6IAAa;QAE/D,yCAAyC;QACzC,MAAM,UAAU,+JAAoB,CAAC,eAAe,CAAC;YACnD,GAAG,cAAc;YACjB,cAAc,eAAe,YAAY;QAC3C;QACA,MAAM,EAAE,QAAQ,EAAE,KAAK,EAAE,GAAG,+JAAoB,CAAC,gBAAgB,CAAC;QAElE,MAAM,QAAQ,IAAA,iJAAgB;QAC9B,MAAM,SAAkC;YAAE,SAAS;QAAK;QAExD,2BAA2B;QAC3B,IAAI,eAAe,MAAM,KAAK,UAAU,eAAe,MAAM,KAAK,QAAQ;YACxE,MAAM,WAAW,+JAAoB,CAAC,UAAU,CAAC,UAAU,OAAO;gBAChE,kBAAkB,eAAe,gBAAgB;gBACjD;YACF;YAEA,MAAM,SAAS,IAAA,yJAAM,EAAC;YACtB,MAAM,GAAG,CAAC,QAAQ;gBAChB,MAAM;gBACN,MAAM;gBACN;gBACA,SAAS;YACX;YAEA,OAAO,cAAc,GAAG;YACxB,IAAI,eAAe,MAAM,KAAK,QAAQ;gBACpC,OAAO,UAAU,GAAG;YACtB;QACF;QAEA,wDAAwD;QACxD,IACE,eAAe,MAAM,KAAK,gBAC1B,eAAe,MAAM,KAAK,QAC1B;YACA,IAAI,eAAe,KAAK,EAAE;gBACxB,IAAI;oBACF,MAAM,qBACJ,MAAM,yJAAiB,CAAC,0BAA0B,CAAC,UAAU;oBAE/D,MAAM,iBAAiB,+JAAoB,CAAC,gBAAgB,CAC1D,oBACA,OACA;wBACE,kBAAkB,eAAe,gBAAgB;wBACjD;oBACF;oBAGF,MAAM,eAAe,IAAA,yJAAM,EAAC;oBAC5B,MAAM,GAAG,CAAC,cAAc;wBACtB,MAAM;wBACN,MAAM;wBACN;wBACA,SAAS;oBACX;oBAEA,OAAO,oBAAoB,GAAG;oBAC9B,IAAI,eAAe,MAAM,KAAK,cAAc;wBAC1C,OAAO,UAAU,GAAG;oBACtB;gBACF,EAAE,OAAO,SAAc;oBACrB,QAAQ,KAAK,CAAC,sCAAsC;oBACpD,OAAO;wBACL,SAAS;wBACT,OAAO,CAAC,mCAAmC,EAAE,QAAQ,OAAO,EAAE;oBAChE;gBACF;YACF,OAAO;gBACL,kCAAkC;gBAClC,MAAM,mBAAmB,yJAAiB,CAAC,cAAc,CACvD,UACA,IACA,GAAG,CAAC,CAAC,IAAM,CAAC;wBACZ,SAAS,GAAG,YAAY,KAAK,EAAE,EAAE,IAAI,CAAC,SAAS,EAAE,EAAE,IAAI,KAAK,aAAa,WAAW,MAAM,CAAC,EAAE,EAAE,IAAI,CAAC,OAAO,CAAC;wBAC5G,UACE,EAAE,IAAI,KAAK,aAAa,sBAAsB;wBAChD,QAAQ,EAAE,MAAM;wBAChB,MAAM,EAAE,IAAI;wBACZ,MAAM,EAAE,IAAI;wBACZ,WAAW,EAAE,SAAS;oBACxB,CAAC;gBAED,MAAM,iBAAiB,+JAAoB,CAAC,gBAAgB,CAC1D,kBACA,OACA;oBACE,kBAAkB,eAAe,gBAAgB;oBACjD;gBACF;gBAGF,MAAM,eAAe,IAAA,yJAAM,EAAC;gBAC5B,MAAM,GAAG,CAAC,cAAc;oBACtB,MAAM;oBACN,MAAM;oBACN;oBACA,SAAS;gBACX;gBAEA,OAAO,oBAAoB,GAAG;gBAC9B,IAAI,eAAe,MAAM,KAAK,cAAc;oBAC1C,OAAO,UAAU,GAAG;gBACtB;YACF;QACF;QAEA,OAAO;IACT,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO;YACL,SAAS;YACT,OAAO,MAAM,OAAO,IAAI;QAC1B;IACF;AACF;;;IA9HsB;;AAAA,+OAAA"}},
    {"offset": {"line": 2181, "column": 0}, "map": {"version":3,"sources":["file:///C:/projetos/math/.next-internal/server/app/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {generateExercises as '40772723c14579758b17be2e8fe43eb50d0cb9bfd1'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}